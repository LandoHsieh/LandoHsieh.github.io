[{"title":"Flutter APK build release å•é¡Œç­†è¨˜","path":"/2025/04/10/Flutter-release-build-note/","content":"æœ€è¿‘åœ¨åš Flutter å°ˆæ¡ˆï¼Œç•¶æˆ‘åœ¨ build release ç‰ˆæœ¬çš„ Android æ™‚ï¼Œé‡åˆ°ä¸€äº›ç“¶é ¸ã€‚ä»¥ä¸‹æ˜¯æˆ‘é‡åˆ°çš„å•é¡Œä»¥åŠå¦‚ä½•è§£æ±ºçš„éç¨‹ã€‚ å•é¡Œæè¿°ç•¶æˆ‘ä½¿ç”¨ flutter build apk --release å»ºç½®å°ˆæ¡ˆæ™‚ï¼Œå‡ºç¾äº†å¾ˆå¤šéŒ¯èª¤ ä¸»è¦å•é¡Œæœ‰ä»¥ä¸‹å…©é¡ï¼š ç¬¬ä¸€é¡ï¼šSDK èˆ‡ AGP ç‰ˆæœ¬å•é¡Œ SDK ç‰ˆæœ¬ä¸åŒ¹é…ï¼šæŸäº›å¥—ä»¶éœ€è¦ Android SDK 35ï¼Œä½†æˆ‘çš„é…ç½®æ˜¯ 34ã€‚ ç•¶æˆ‘å‡ç´š SDK ç‚º 35 å¾Œï¼Œåˆå‡ºç¾ AGP ç‰ˆæœ¬å¿…é ˆ â‰¥ 8.1.0 çš„å•é¡Œ æˆ‘é€é Android Studio çš„ AGP Upgrade Assistant ä¾†å˜—è©¦æ›´æ–° AGPï¼Œå»æ²’çœ‹åˆ° 8.0.0 ä»¥ä¸Šçš„ç‰ˆæœ¬ ç¬¬äºŒé¡ï¼šbuild release æœƒç¼ºå°‘ä¸€äº›å¿…è¦ class ç¼ºå°‘å¿…è¦çš„é¡ï¼šBouncyCastle å’Œ FindBugs è¨»è§£é¡ç¼ºå¤±ï¼Œå°è‡´å»ºç½®å¤±æ•—ã€‚ è§£æ±ºæ–¹æ³•ç‚ºäº†è§£æ±ºé€™äº›å•é¡Œï¼Œæˆ‘åšäº†ä»¥ä¸‹å¹¾æ­¥ï¼š æˆ‘ç™¼ç¾ Android Studio å› ç‚ºç‰ˆæœ¬éèˆŠï¼Œæ‰€ä»¥æ‰æ‰¾ä¸åˆ° AGP8.0.0 ä»¥ä¸Šçš„ç‰ˆæœ¬å¯ä»¥å®‰è£ï¼Œå› æ­¤è‡³å®˜æ–¹ä¸‹è¼‰æœ€æ–°ç‰ˆæœ¬ Android Studio å¾Œï¼Œå°±èƒ½é€é AGP Upgrade Assistant ä¾†å¹«ä½ æ›´æ–°æœ€æ–°çš„ AGP versionã€‚ AGP æ›´æ–°ç‚º 8.1.0 å¾Œï¼Œå°‡ build.gradle ä¸­çš„ compileSdk å’Œ targetSdkVersion è¨­ç½®ç‚º 35ï¼Œä»¥æ»¿è¶³å¥—ä»¶çš„éœ€æ±‚ã€‚ æ·»åŠ  BouncyCastle å’Œ FindBugs çš„ä¾è³´ï¼Œä»¥ç¢ºä¿æ‰€æœ‰å¿…è¦çš„é¡éƒ½å­˜åœ¨ã€‚ï¼ˆä¸‹æ–¹è©³ç´°èªªæ˜ï¼‰ åœ¨ proguard-rules.pro ä¸­æ·»åŠ è¦å‰‡ï¼Œä¿ç•™é€™äº›é¡ï¼Œé¿å…è¢« ProGuard ç§»é™¤ã€‚ï¼ˆä¸‹æ–¹è©³ç´°èªªæ˜ï¼‰ é€é Android Studio æŸ¥çœ‹å°ˆæ¡ˆç‰ˆæœ¬ åœ¨å°ˆæ¡ˆä¸­å° android å³éµï¼Œé¸æ“‡ Open in Android Studio Android Studio é¦–æ¬¡æ‰“é–‹å°ˆæ¡ˆéœ€è¦ä¸€é»æ™‚é–“ç­‰ä»–è·‘å®Œï¼Œä½ å¯ä»¥å…ˆå»æ»‘å€‹æ‰‹æ©Ÿç­‰ç­‰ä»– æ‰“é–‹ File â†’ Project Structure å°±èƒ½çœ‹åˆ°ç›¸é—œç‰ˆæœ¬è³‡è¨Š SDK, AGP, Gradle plugin version ç­‰ç­‰ æ·»åŠ  BouncyCastle å’Œ FindBugs çš„ä¾è³´ï¼ˆä»¥ä¸‹æ­¥é©Ÿç‚ºå¦‚æœåœ¨ build release ç‰ˆæœ¬æ™‚æœ‰é‡åˆ°é—œæ–¼ BouncyCastle çš„å•é¡Œæ‰éœ€è¦åšã€‚ï¼‰ åœ¨ android/app/build.gradle ä¸­ dependencies çš„éƒ¨åˆ†è¦åŠ å…¥ä»¥ä¸‹ä¾è³´ 123456dependencies &#123; implementation platform(&#x27;com.google.firebase:firebase-bom:33.12.0&#x27;) implementation &#x27;org.bouncycastle:bcprov-jdk15on:1.70&#x27; implementation &#x27;org.bouncycastle:bcpkix-jdk15on:1.70&#x27; implementation &#x27;com.google.code.findbugs:jsr305:3.0.2&#x27;&#125; ç¨å¾®è§£é‡‹ä¸€ä¸‹é€™å¹¾å€‹ä¾è³´çš„ç”¨é€” BouncyCastle ç›¸é—œä¾è³´ï¼š12implementation &#x27;org.bouncycastle:bcprov-jdk15on:1.70&#x27;implementation &#x27;org.bouncycastle:bcpkix-jdk15on:1.70&#x27; BouncyCastle æ˜¯ä¸€å€‹åŠ å¯†åº« bcprov æä¾›æ ¸å¿ƒåŠ å¯†åŠŸèƒ½ bcpkix æä¾› PKI&#x2F;X.509 ç›¸é—œåŠŸèƒ½ï¼Œ é€™äº›æ˜¯å¿…é ˆçš„ï¼Œå› ç‚º MSAL èªè­‰å’Œ JWT è™•ç†éƒ½éœ€è¦é€™äº›åŠ å¯†åŠŸèƒ½ FindBugs ä¾è³´ï¼š1implementation &#x27;com.google.code.findbugs:jsr305:3.0.2&#x27; æä¾› @NonNullã€@Nullable ç­‰è¨»è§£ MSAL åº«ä½¿ç”¨é€™äº›è¨»è§£ä¾†æ¨™è¨˜åƒæ•¸çš„å¯ç©ºæ€§ é€™å€‹ä¹Ÿæ˜¯å¿…é ˆçš„ï¼Œå› ç‚º MSAL çš„ç¨‹å¼ç¢¼ä¾è³´é€™äº›è¨»è§£ proguard-rules.pro æ·»åŠ è¦å‰‡é—œæ–¼ proguard-rules.proï¼Œé€™å€‹æ–‡ä»¶æ˜¯ Android å°ˆæ¡ˆçš„ ProGuard é…ç½®æ–‡ä»¶ï¼Œåœ¨ build release ç‰ˆæœ¬æ™‚éå¸¸é‡è¦ï¼Œç‰¹åˆ¥æ˜¯ç•¶æˆ‘å€‘å•Ÿç”¨ç¨‹å¼ç¢¼æ··æ·†ï¼ˆminificationï¼‰çš„åŠŸèƒ½ã€‚ åœ¨ android/app/build.gradle ä¸­ï¼Œæˆ‘å€‘æœ‰å¯«åˆ° 1234567891011buildTypes &#123; release &#123; signingConfig signingConfigs.release // ä½¿ç”¨ç¨‹å¼ç¢¼æ··æ·† minifyEnabled true // åˆªé™¤æœªä½¿ç”¨è³‡æº shrinkResources true // æ·»åŠ proguardè¦å‰‡ proguardFiles getDefaultProguardFile(&#x27;proguard-android.txt&#x27;), &#x27;proguard-rules.pro&#x27; &#125; &#125; å¾è£¡é¢å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘å€‘å•Ÿç”¨ minifyEnabled å¾Œï¼ŒProGuard æœƒå¹«æˆ‘å€‘åˆªé™¤æœªä½¿ç”¨çš„ç¨‹å¼ç¢¼ä¸¦é€²è¡Œæ··æ·†ï¼Œç”¨è™•æ˜¯è®“æ‰“åŒ…å¾Œçš„ APK è®Šå¾—æ›´å°ä»¥åŠæ›´å®‰å…¨ï¼Œä½†é€™éº¼åšæœ‰å€‹ç¼ºé»ï¼Œå› ç‚ºæœ‰äº›é¡æ˜¯é€šéåå°„æˆ–å‹•æ…‹è¼‰å…¥çš„ï¼ŒProGuard å¯èƒ½æœƒèª¤åˆ¤ç‚ºæœªä½¿ç”¨è€Œç§»é™¤ï¼Œæ‰€ä»¥æˆ‘å€‘è¦æ·»åŠ  proguard-rules.pro ä¾†å‘Šè¨´ ProGuard å“ªäº›é¡å¿…é ˆä¿ç•™ï¼Œä¸èƒ½è¢«ç§»é™¤æˆ–æ··æ·†ã€‚ åœ¨ android/app åº•ä¸‹åŠ å…¥ proguard-rules.pro 1234567891011# Keep BouncyCastle classes-keep class org.bouncycastle.** &#123; *; &#125;-dontwarn org.bouncycastle.**# Keep FindBugs annotations-keep class edu.umd.cs.findbugs.** &#123; *; &#125;-dontwarn edu.umd.cs.findbugs.**# Keep MSAL classes-keep class com.microsoft.identity.** &#123; *; &#125;-dontwarn com.microsoft.identity.** é‚£å¦‚æœä¸å•“ç”¨ç¨‹å¼ç¢¼æ··æ·†æ˜¯ä¸æ˜¯å°±ä¸ç”¨åŠ å…¥ proguard-rules.proï¼Ÿå¦‚æœä¸èµ·ç”¨ minifyEnabledï¼Œä¹Ÿä¸æ·»åŠ  proguard-rules.pro çš„è©±ï¼Œç›´æ¥åŸ·è¡Œ flutter build apk --release ï¼Œé‚„æ˜¯æœƒçœ‹åˆ°ä¸€å †å¯æ€•çš„è¨Šæ¯ï¼Œå¦‚ä¸‹åœ–ï¼š é€™æ˜¯å› ç‚ºï¼Œå°±ç®—ä¸å•“ç”¨ minifyEnabled å’Œ shrinkResourcesï¼ŒR8 ä¹Ÿä¸€æ¨£æœƒåœ¨ release å»ºç½®ä¸­é‹è¡Œï¼ŒR8 æ˜¯ ProGuard çš„æ›¿ä»£å“ï¼Œè² è²¬å£“ç¸®å’Œå„ªåŒ–ç¨‹å¼ç¢¼ã€‚å®ƒæœƒè‡ªå‹•å˜—è©¦ç§»é™¤æœªä½¿ç”¨çš„é¡å’Œæ–¹æ³•ã€‚ æ‰€ä»¥å°±ç®—ä¸èµ·ç”¨ minifyEnabledï¼Œç¨‹å¼ç¢¼ä¹Ÿæ˜¯æœƒå—åˆ° R8 è‡ªå‹•åˆªé™¤çš„å½±éŸ¿ï¼Œå› æ­¤åŠ å…¥ proguard-rules.pro æ˜¯å¿…è¦çš„ åŠ å…¥å¾Œï¼ŒåŸ·è¡Œ flutter build apk â€”release å°±æˆåŠŸå˜ï¼ çµæœç¶“éé€™äº›ä¿®æ”¹å¾Œï¼Œrelease build æˆåŠŸäº†ï¼APK å¤§å°æ¸›å°‘ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸é‹è¡Œã€‚ å¿ƒå¾—é€™æ¬¡ç¶“é©—è®“æˆ‘å­¸åˆ°ï¼Œrelease build éœ€è¦ç‰¹åˆ¥æ³¨æ„ä¾è³´å’Œ ProGuard è¦å‰‡çš„é…ç½®ï¼Œé€™æ¨£æ‰èƒ½é¿å…ä¸å¿…è¦çš„å•é¡Œã€‚","tags":["FlutteréŒ¯èª¤ç­†è¨˜"]},{"title":"Flutter æ•´åˆ MSAL(Microsoft Authentication Library) ç­†è¨˜","path":"/2025/04/10/Flutter-Msal-note/","content":"é€™ç¯‡ç­†è¨˜æœƒæ•™ä½  Flutter å°ˆæ¡ˆä¸­æ•´åˆ Microsoft Authentication Library (MSAL)ï¼ŒåŒ…å« iOS å’Œ Android å¹³å°çš„å®Œæ•´è¨­å®šæ­¥é©Ÿã€‚ æ•´åˆ MSAL ç™»å…¥æµç¨‹ (iOS)Azure Portal æ–°å¢ iOS å¹³å° åˆ° Azure Portal è¨»å†Šä½ çš„ APP ç®¡ç† â†’ é©—è­‰ï¼Œæ–°å¢ iOS&#x2F;Android å¹³å° iOS åªéœ€è¦æŠŠä½ çš„ APP Bundle ID åŠ å…¥é…å¥—è­˜åˆ¥ç¢¼å³å¯ Runner è¨­å®š åœ¨ä½ çš„å°ˆæ¡ˆä¸­ç”¨ terminal æ‰“é–‹ Runner.xcworkspaceï¼Œæˆ–è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ 1open ios/Runner.xcworkspace/ æ·»åŠ ä¸€å€‹ Keychain Sharing çš„ Capabilityï¼Œä¸¦å°‡ com.microsoft.adalcache åŠ å…¥ Keychain Group ä¸­ é€™éº¼åšæ˜¯å› ç‚ºï¼ŒMSAL ç™»å…¥å¾Œæœƒå°‡ä½¿ç”¨è€…çš„ç™»å…¥è³‡è¨Šå­˜æ”¾åœ¨ Keychain iOS çš„å®‰å…¨å„²å­˜ç³»çµ±ä¸­ï¼Œå„²å­˜çš„å…§å®¹åŒ…æ‹¬å¦‚ä¸‹ Access Token Refresh Token ID Token ä½¿ç”¨è€…å¸³æˆ¶è³‡è¨Š Token çš„éæœŸæ™‚é–“ç­‰ ä¹Ÿå› æ­¤ï¼Œå°±ç®—é‡æ–°æ‰“é–‹ APPï¼Œä¹Ÿæœƒç¹¼çºŒé¡¯ç¤ºç‚ºç™»å…¥ç‹€æ…‹ï¼Œå¦‚æœè¦ç™»å‡ºçš„è©±ï¼Œå°±è¦å‘¼å«signOut()å‹•ä½œï¼Œæœƒè‡ªå‹•æ¸…é™¤ keychain ä¸­çš„ç™»å…¥è³‡è¨Šã€‚ æ¸…é™¤çš„å…§å®¹æœƒæœ‰ä»¥ä¸‹ï¼š æ¸…é™¤ Keychain ä¸­å„²å­˜çš„æ‰€æœ‰èªè­‰è³‡è¨Š ç§»é™¤å¿«å–çš„ token æ¸…é™¤ç•¶å‰ç™»å…¥çš„å¸³æˆ¶è³‡è¨Š Info.plist è¨­å®š ï¼ˆå¿…è¦ï¼‰åŠ å…¥ redirect URI schemeï¼ˆé€™æ®µæ˜¯ç‚ºäº†åœ¨ä½ ç™»å…¥å¾Œå°‡ç™»å…¥è³‡è¨Šå›å‚³çµ¦ä½ çš„ APPï¼Œä¸€å®šè¦åŠ ï¼‰ 123456789&lt;key&gt;CFBundleURLTypes&lt;/key&gt;&lt;array&gt; &lt;dict&gt; &lt;key&gt;CFBundleURLSchemes&lt;/key&gt; &lt;array&gt; &lt;string&gt;msauth.$(PRODUCT_BUNDLE_IDENTIFIER)&lt;/string&gt; &lt;/array&gt; &lt;/dict&gt;&lt;/array&gt; ï¼ˆå¯é¸ï¼‰å¦‚æœæ‰‹æ©Ÿæœ‰å®‰è£ Microsoft çš„ Authenticator é€™å€‹ APP çš„è©±ï¼Œä½ å¸Œæœ›åœ¨ä½  APP MSAL ç™»å…¥æ™‚ï¼Œéƒ½è‡ªå‹•æ‰“é–‹ Authenticator APP ä¾†åšç™»å…¥ï¼Œå°±è¦åŠ å…¥ä»¥ä¸‹ Schemeï¼Œä½†è‹¥ç´”ç²¹æŒ‡å®šä½¿ç”¨ webview ä¾†ç™»å…¥ï¼Œå°±ä¸éœ€è¦ï¼ˆä½†ä¹Ÿå¯ä»¥ä¿ç•™ï¼‰ 12345&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;&lt;array&gt; &lt;string&gt;msauthv2&lt;/string&gt; &lt;string&gt;msauthv3&lt;/string&gt;&lt;/array&gt; æ¥ä¸‹ä¾†å°±å¯ä»¥é–‹å§‹å¯«ç¨‹å¼ç¢¼ä½¿ç”¨ MSAL ç™»å…¥äº† ç¨‹å¼ç¢¼initial MSAL, iOS çš„éƒ¨åˆ†åªéœ€è¦å¯«å…¥ä½ çš„ Authority åƒæ•¸å³å¯é€šå¸¸ç‚º â€œ[https://login.microsoftonline.com/common](https://login.microsoftonline.com/common)â€ commonï¼šæ‰€æœ‰å¸³è™Ÿéƒ½èƒ½å­˜å–organizationsï¼šåªå…è¨±çµ„ç¹”å¸³è™Ÿå­˜å–xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxï¼šç‰¹å®šçµ„ç¹”å¸³è™Ÿ 1234567msalClient = await SingleAccountPca.create( appleConfig: AppleConfig( authority: dotenv.env[&#x27;AAD_APPLE_AUTHORITY&#x27;] ?? &#x27;&#x27;, authorityType: AuthorityType.aad, broker: Broker.webView, ), ); broker çš„éƒ¨åˆ†ç‚ºé¸æ“‡è¦è·³å‡ºä¾†çš„ç™»å…¥é é¢æ˜¯å“ªä¸€ç¨®ï¼Œé€™é‚ŠæŒ‡å®š webView æ•´åˆ MSAL ç™»å…¥æµç¨‹ (Android)Azure Portal æ–°å¢ Android å¹³å° è·Ÿ iOS å·®ä¸å¤šï¼Œåªæ˜¯å¤šæ–°å¢ä¸€å€‹ Android çš„å¹³å° å¥—ä»¶åç¨±å¡«å…¥ä½ çš„ Bundle ID ç°½ç« é›œæ¹Šç”¨ä»¥ä¸‹æŒ‡ä»¤åœ¨ä½ çš„ terminal ä¸­åŸ·è¡Œï¼Œæ³¨æ„ä»¥ä¸‹å…©é» app/ åº•ä¸‹è¨˜å¾—å…ˆç”¢ç”Ÿå¥½ release ç”¨çš„ upload-keystore.jks æŒ‡ä»¤è¦åœ¨ä½ çš„å°ˆæ¡ˆè·Ÿç›®éŒ„ä¸­åŸ·è¡Œ 1keytool -exportcert -alias androidreleasekey -keystore app/upload-keystore.jks | openssl sha1 -binary | openssl base64 å»ºç«‹ msal_config.jsonåœ¨ä½ çš„å°ˆæ¡ˆä¸­å»ºç«‹ msal_config.json ï¼ˆæ”¾å“ªè£éƒ½å¯ä»¥ï¼Œæˆ‘æ˜¯æ”¾åœ¨assets/ å…§ï¼Œè¨˜å¾—åˆ°pubspec.yaml æŒ‡å®šè©²è³‡æ–™å¤¾ï¼Œå¦å‰‡å¼•ç”¨ä¸åˆ°ï¼‰ 12345&#123; &quot;account_mode&quot;: &quot;SINGLE&quot;, &quot;broker_redirect_uri_registered&quot;: false, &quot;authorization_user_agent&quot;: &quot;BROWSER&quot;&#125; AndroidManifest.xml æ·»åŠ ä¾è³´åˆ° android/app/src/main/AndroidManifest.xml æ·»åŠ ä»¥ä¸‹ 12345678910111213141516&lt;application&gt;... &lt;activity android:name=&quot;com.microsoft.identity.client.BrowserTabActivity&quot;&gt; &lt;intent-filter&gt; &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt; &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt; &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt; &lt;data android:host=&quot;é€™é‚Šå¡«å…¥ä½ çš„ Bundle ID&quot; android:path=&quot;/ä½ å‰›ç”¨æŒ‡ä»¤ç”Ÿæˆçš„ç°½ç« é›œæ¹Šå€¼&quot; android:scheme=&quot;msauth&quot; /&gt; &lt;/intent-filter&gt; &lt;/activity&gt;&lt;/application&gt; ç¨‹å¼ç¢¼ å¡«å…¥ä½ çš„ Client ID æŒ‡å®š msal_config.json ä½ç½® å¡«å…¥ Redirect URI ï¼ˆç”¨ç°½ç« é›œæ¹Šç”¢ç”Ÿçš„ URIï¼‰ 1234567msalClient = await SingleAccountPca.create( clientId: dotenv.env[&#x27;AAD_CLIENT_ID&#x27;] ?? &#x27;&#x27;, androidConfig: AndroidConfig( configFilePath: &#x27;assets/msal_config.json&#x27;, redirectUri: dotenv.env[&#x27;AAD_ANDROID_REDIRECT_URI&#x27;] ?? &#x27;&#x27;, ), ); aad_oauth ä»¥åŠ msal_auth å…©è€…å¥—ä»¶å·®ç•°ï¼Ÿaad_oauth ç”¨é€”ï¼šä¸»è¦ç”¨æ–¼èˆ‡ Azure Active Directory (AAD) é€²è¡Œ OAuth èªè­‰ã€‚ åŠŸèƒ½: æä¾›ç°¡å–®çš„ OAuth2 èªè­‰æµç¨‹ï¼Œèƒ½å¤ ç²å– access_token å’Œåˆ·æ–° tokenã€‚ é©ç”¨å ´æ™¯: é©åˆéœ€è¦èˆ‡ Azure AD æ•´åˆçš„ Appï¼Œç‰¹åˆ¥æ˜¯é‚£äº›ä¸éœ€è¦è¤‡é›œçš„èº«ä»½é©—è­‰é‚è¼¯çš„æ‡‰ç”¨ã€‚ msal_auth ç”¨é€”: åŸºæ–¼ MicrosoftÂ Authentication LibraryÂ (MSAL) çš„èº«ä»½é©—è­‰å¥—ä»¶ã€‚ åŠŸèƒ½: æä¾›æ›´å…¨é¢çš„èº«ä»½é©—è­‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ”¯æ´å¤šçµ„ç¹”å¸³æˆ¶ã€å¸³æˆ¶åˆ‡æ›ã€token ç·©å­˜ç­‰ã€‚ é©ç”¨å ´æ™¯: é©åˆéœ€è¦æ›´è¤‡é›œçš„èº«ä»½é©—è­‰é‚è¼¯çš„æ‡‰ç”¨ç¨‹åºï¼Œç‰¹åˆ¥æ˜¯é‚£äº›éœ€è¦æ”¯æŒå¤šçµ„ç¹”å¸³æˆ¶æˆ–éœ€è¦æ›´é«˜ç´šçš„èº«ä»½é©—è­‰åŠŸèƒ½çš„æ‡‰ç”¨ã€‚ çµè«–aad_oauth ç”¨æ–¼ å°ˆæ¡ˆè¦æ¨¡å° å¿«é€Ÿå¯¦ç¾ç°¡å–®èªè­‰ ä¸éœ€ç‰¹åˆ¥å®‰å…¨éœ€æ±‚ åŸå‹é–‹ç™¼æˆ–æ¦‚å¿µé©—è­‰ msal_auth ç”¨æ–¼ éœ€è¦ä¼æ¥­ç´šçš„å®‰å…¨æ€§ éœ€è¦æ”¯æ´ Microsoft Authenticator éœ€è¦è™•ç†è¤‡é›œçš„èªè­‰å ´æ™¯ éœ€è¦èˆ‡ Microsoft æœå‹™æ·±åº¦æ•´åˆ é•·æœŸç¶­è­·çš„å°ˆæ¡ˆ","tags":["Flutter"]},{"title":"ğŸ“ Flutter éŒ¯èª¤ç­†è¨˜ï¼šLexical or Preprocessor Issue (Include of non-modular headerâ€¦)","path":"/2025/03/03/Xcode_Error_Lexical_or_Preprocessor_Issue/","content":"ğŸ” å‰è¨€ä»Šå¤©åœ¨åŸ·è¡Œ Flutter + Firebase çš„å°ˆæ¡ˆæ™‚é‡åˆ°ä¸€å€‹å•é¡Œï¼Œç™¼ç”Ÿåœ¨ Xcode 15+ ç‰ˆæœ¬ã€‚ç•¶åŸ·è¡Œ flutter runï¼ŒFirebase çš„ firebase_messaging æœƒå ±éŒ¯ä»¥ä¸‹é€™å‰‡è¨Šæ¯ï¼š 1Lexical or Preprocessor Issue Include of non-modular header inside framework module &#x27;firebase_messaging&#x27;. é€™å°è‡´æ•´å€‹å°ˆæ¡ˆç„¡æ³•æˆåŠŸç·¨è­¯ã€‚ å¾Œä¾†ç™¼ç¾é€™å€‹éŒ¯èª¤ä¸»è¦ç™¼ç”Ÿåœ¨ Xcode æ›´æ–°å¾Œï¼Œå½±éŸ¿äº†ä¸€äº›ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼ˆä¾‹å¦‚ Firebaseï¼‰ã€‚é¿å…ä»¥å¾Œç™¼ç”ŸåŒæ¨£å•é¡Œï¼Œç‚ºæ­¤æ•´ç†äº†ä¸€ç¯‡ç­†è¨˜ã€‚ ğŸ¤” ç‚ºä»€éº¼æœƒç™¼ç”Ÿé€™å€‹éŒ¯èª¤ï¼Ÿé€™èˆ‡ Xcode çš„æ¨¡çµ„åŒ–ç·¨è­¯è¦å‰‡ æœ‰é—œã€‚Xcode åœ¨è¼ƒæ–°çš„ç‰ˆæœ¬ä¸­ï¼Œæ›´åš´æ ¼åœ°é™åˆ¶äº† éæ¨¡çµ„åŒ–ï¼ˆNon-modularï¼‰Header æª”æ¡ˆ çš„å¼•ç”¨æ–¹å¼ã€‚ åœ¨ Apple çš„æ¨¡çµ„åŒ–ç·¨è­¯æ¨¡å¼ï¼ˆModular Build Systemï¼‰ä¸‹ï¼Œæ¯å€‹ Frameworkï¼ˆæˆ– Moduleï¼‰å…§éƒ¨çš„ Header æ‡‰è©²è¢«æ˜ç¢ºæ¨™è¨˜ç‚º public æˆ– privateï¼Œé¿å…é–‹ç™¼è€…ç›´æ¥ä½¿ç”¨å…§éƒ¨ APIã€‚ ä½†é‚„æ˜¯æœ‰ä¸€äº› ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼ˆå¦‚ Firebaseï¼‰ ä»ç„¶åŒ…å«äº†ä¸€äº›éæ¨¡çµ„åŒ–çš„ Header æª”æ¡ˆï¼Œè€Œ Xcode é è¨­ä¸å…è¨±é€™ç¨®æ–¹å¼ï¼Œå› æ­¤åœ¨ firebase_messaging å˜—è©¦å¼•ç”¨é€™äº›æª”æ¡ˆæ™‚ï¼Œç·¨è­¯å™¨æœƒå ±éŒ¯ã€‚ âœ… è§£æ±ºæ–¹æ¡ˆè§£æ³•æ˜¯ä¿®æ”¹ Xcode çš„ Build Settingsï¼Œå…è¨±å°ˆæ¡ˆä½¿ç”¨ éæ¨¡çµ„åŒ–çš„ Header æª”æ¡ˆï¼š 1ï¸âƒ£ æ‰“é–‹ Xcodeï¼Œé–‹å•Ÿ Flutter å°ˆæ¡ˆçš„ iOS ç›®éŒ„ â€¢\tåŸ·è¡Œ open ios&#x2F;Runner.xcworkspaceï¼ˆè¦ç”¨ xcworkspace è€Œä¸æ˜¯ xcodeprojï¼‰ã€‚ 2ï¸âƒ£ é€²å…¥ Build Settings â€¢\tåœ¨å·¦å´é¸æ“‡ Runnerï¼Œåˆ‡æ›åˆ° Build Settingsã€‚ â€¢\tåœ¨æœå°‹æ¡†è¼¸å…¥ Allow Non-modular Includes In Framework Modulesã€‚ 3ï¸âƒ£ å°‡æ­¤è¨­å®šæ”¹ç‚º YES â€¢\té è¨­æƒ…æ³ä¸‹ï¼Œé€™å€‹é¸é …æ˜¯ NOï¼Œé€™ä»£è¡¨ Xcode æœƒå¼·åˆ¶éµå®ˆæ¨¡çµ„åŒ–è¦å‰‡ã€‚ â€¢\tè¨­ç‚º YES å¾Œï¼ŒXcode å…è¨± åœ¨ Framework Modules å…§éƒ¨åŒ…å«éæ¨¡çµ„åŒ– Headerï¼Œé€™æ¨£ Firebase å°±ä¸æœƒå› ç‚ºé€™å€‹é™åˆ¶è€Œå ±éŒ¯ã€‚ 4ï¸âƒ£ é‡æ–°åŸ·è¡Œ Flutter å°ˆæ¡ˆ â€¢\tåŸ·è¡Œ flutter clean æ¸…é™¤å¿«å–ã€‚ â€¢\tåŸ·è¡Œ cd ios &amp;&amp; pod install é‡æ–°å®‰è£ iOS ä¾è³´ã€‚ â€¢\tå›åˆ°å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼ŒåŸ·è¡Œ flutter runï¼Œæ‡‰è©²å°±èƒ½é †åˆ©ç·¨è­¯ã€‚ ğŸ¯ ç‚ºä»€éº¼é€™æ¨£èƒ½è§£æ±ºå•é¡Œï¼Ÿè¨­å®š Allow Non-modular Includes In Framework Modules = YES ä¹‹å¾Œï¼ŒXcode æœƒå…è¨± ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼ˆå¦‚ Firebaseï¼‰å¼•ç”¨æœªæ¨™è¨˜ç‚ºæ¨¡çµ„åŒ–çš„ Header æª”æ¡ˆã€‚ æœ¬è³ªä¸Šï¼Œé€™å€‹è¨­å®šæ˜¯æ”¾å¯¬äº† Xcode çš„åš´æ ¼è¦å‰‡ï¼Œè®“å°ˆæ¡ˆå¯ä»¥ç¹¼çºŒä½¿ç”¨é€™äº› éæ¨¡çµ„åŒ–çš„ Header æª”æ¡ˆï¼Œé¿å…ç·¨è­¯æ™‚å ±éŒ¯ã€‚ ä¸éé€™ä¸¦éè§£æ±ºå•é¡Œæ ¹æœ¬çš„æ–¹æ³•ï¼Œæœ€å¥½çš„æ–¹å¼é‚„æ˜¯ ç­‰å¾… Firebase æ›´æ–°ä»¥é©é…æ–°çš„ Xcodeï¼Œæˆ–è€…æ‰‹å‹•èª¿æ•´ Firebase çš„ module.modulemap ä¾†æ˜ç¢ºæ¨™è¨˜ Header çš„å¯è¦‹æ€§ï¼ˆé€™éœ€è¦ä¿®æ”¹ Firebase å¥—ä»¶çš„å…§éƒ¨çµæ§‹ï¼Œé¢¨éšªè¼ƒé«˜ï¼‰ã€‚ ğŸ’¡ å»ºè­°1ï¸âƒ£ ç¢ºä¿ Firebase SDK æ˜¯æœ€æ–°ç‰ˆæœ¬ â€¢\tå¦‚æœ Firebase å·²ç¶“é‡‹å‡ºé‡å° Xcode 15+ çš„æ›´æ–°ï¼Œæ‡‰è©²å„ªå…ˆæ›´æ–°ï¼Œè€Œä¸æ˜¯é•·æœŸä¾è³´ Allow Non-modular Includes In Framework Modules = YESã€‚ â€¢\tæ›´æ–°æ–¹å¼ï¼š 12flutter pub upgrade firebase_messagingcd ios &amp;&amp; pod update 2ï¸âƒ£ é¿å…ç›´æ¥ä¿®æ”¹ Xcode è¨­å®šï¼Œé™¤éå¿…è¦ â€¢\té€™å€‹è¨­å®šæ˜¯ é™ä½ Xcode çš„ç·¨è­¯åš´æ ¼æ€§ï¼Œé›–ç„¶èƒ½è§£æ±ºå•é¡Œï¼Œä½†é•·é ä¾†çœ‹ï¼Œé‚„æ˜¯è¦è®“å°ˆæ¡ˆç¬¦åˆ Apple çš„æ¨¡çµ„åŒ–è¦ç¯„ã€‚ 3ï¸âƒ£ å¦‚æœé‡åˆ°å…¶ä»– Firebase ç›¸é—œéŒ¯èª¤ï¼Œå¯ä»¥è©¦è©¦é€™äº›æ­¥é©Ÿ â€¢\tflutter clean â€¢\trm -rf ios&#x2F;Pods ios&#x2F;Podfile.lock â€¢\tcd ios &amp;&amp; pod install â€¢\tflutter run ğŸ ç¸½çµå•é¡Œï¼šXcode 15+ è®Šæ›´ç·¨è­¯è¦å‰‡ï¼Œå°è‡´ Firebase çš„ firebase_messaging ç„¡æ³•ä½¿ç”¨éæ¨¡çµ„åŒ–çš„ Headerã€‚ è§£æ³•ï¼šåœ¨ Xcode Build Settings è¨­å®š Allow Non-modular Includes In Framework Modules = YESï¼Œæ”¾å¯¬ Xcode çš„æ¨¡çµ„åŒ–é™åˆ¶ã€‚ å»ºè­°ï¼š â€¢\té•·æœŸä¾†çœ‹ï¼Œæ‡‰è©²ç­‰å¾… Firebase å®˜æ–¹æ›´æ–°ï¼Œé¿å…ç›´æ¥ä¿®æ”¹ Xcode è¨­å®šã€‚ â€¢\tç¢ºä¿ Firebase SDK ç¶­æŒæœ€æ–°ç‰ˆæœ¬ï¼Œæ¸›å°‘æœªä¾†èˆ‡ Xcode çš„ç›¸å®¹æ€§å•é¡Œã€‚","tags":["FlutteréŒ¯èª¤ç­†è¨˜"]},{"title":"JWTæ˜¯å¦‚ä½•çµ„æˆçš„","path":"/2024/08/16/HowJWTWork/","content":"JWT çµæ§‹JWT æ˜¯ç”±ä¸‰éƒ¨åˆ†çµ„æˆï¼Œä¸¦ç”¨ &quot;.&quot; åˆ†éš”ï¼š Header Payload Signature 1. Header é€šå¸¸åŒ…å«å…©å€‹å±¬æ€§ï¼š alg: ç°½åç®—æ³•ï¼ˆä¾‹å¦‚ HMAC SHA256ï¼‰ã€‚ typ: Token çš„é¡å‹ï¼ˆé€šå¸¸ç‚º â€œJWTâ€ï¼‰ã€‚ å…§å®¹ä»¥ JSON æ ¼å¼è¡¨ç¤ºï¼Œç„¶å¾Œé€²è¡Œ Base64URL ç·¨ç¢¼ã€‚ 2. Payload åŒ…å«è²æ˜ï¼ˆclaimsï¼‰ï¼Œåˆ†ç‚ºä¸‰é¡ï¼š è¨»å†Šçš„è²æ˜ï¼šé å®šç¾©çš„å±¬æ€§ï¼ˆåƒæ˜¯ sub, iat, expï¼‰ï¼Œæä¾›é—œæ–¼ token çš„ä¸€äº›åŸºæœ¬è³‡è¨Šã€‚ å…¬å…±è²æ˜ï¼šå¯ä»¥è‡ªè¡Œå®šç¾©å…§å®¹ï¼Œåƒæ˜¯ name, Email ç­‰ç­‰ã€‚ ç§æœ‰è²æ˜ï¼šä¾æ‡‰ç”¨ç¨‹åºéœ€æ±‚è‡ªå®šç¾©çš„è²æ˜ã€‚ åŒæ¨£ä»¥ JSON æ ¼å¼è¡¨ç¤ºä¸¦é€²è¡Œ Base64URL ç·¨ç¢¼ã€‚ 3. Signature ç”¨ä¾†é©—è­‰ token çš„å®Œæ•´æ€§å’Œä¾†æºã€‚ ç”Ÿæˆæ–¹æ³•ï¼š å…ˆå°‡ header å’Œ payload çš„ç·¨ç¢¼çµæœé€£æ¥èµ·ä¾†ï¼š &lt;encoded header&gt;.&lt;encoded payload&gt;ã€‚ å°‡å…¶èˆ‡ secret key çµåˆï¼Œä¸¦ä½¿ç”¨æŒ‡å®šçš„ç°½åç®—æ³•é€²è¡Œ HMACSHA256 åŠ å¯†ã€‚ æœ€å¾Œç”Ÿæˆçš„ signature æ ¼å¼ç‚º Base64URL ç·¨ç¢¼ã€‚ JWT çš„çµ„åˆæœ€çµ‚ç”Ÿæˆçš„ JWT æ ¼å¼ç‚ºï¼š &lt;encoded header&gt;.&lt;encoded payload&gt;.&lt;signature&gt; æ³¨æ„äº‹é … Base64URL ç·¨ç¢¼ è·Ÿå¸¸è¦çš„ Base64 ç·¨ç¢¼ ä¸ä¸€æ¨£ï¼š JWT ä¸»è¦ä½¿ç”¨ Base64URL ç·¨ç¢¼ å»åš encode è‹¥ç”¨ ä¸€èˆ¬ Base64 ç·¨ç¢¼ å»ç”¢ç”Ÿ JWTï¼Œæœƒå°è‡´ç„¡æ³•é©—æ­£ï¼Œå› ç‚º ä¸€èˆ¬ Base64 åŒ…å«äº†ç‰¹æ®Šå­—å…ƒ Base64 vs Base64URL å·®ç•°å®šç¾© Base64: ä¸€ç¨®å°‡äºŒé€²ä½è³‡æ–™ç·¨ç¢¼æˆå¯å‚³è¼¸çš„ ASCII å­—ç¬¦ä¸²çš„ç®—æ³•ã€‚ Base64URL: é€™æ˜¯åŸºæ–¼ Base64 æ‰€è¡ç”Ÿå‡ºä¾†çš„ï¼Œå°ˆé–€ç‚º URL è·Ÿç¶²é æ‡‰ç”¨è¨­è¨ˆï¼Œä¸»è¦æ˜¯é¿å…è·Ÿç¶²é  URL ä¸­çš„ç‰¹æ®Šå­—ç¬¦ç™¼ç”Ÿè¡çªã€‚ ä¸»è¦å·®ç•° å­—ç¬¦æ›¿æ› Base64 ä½¿ç”¨ä»¥ä¸‹å­—ç¬¦ï¼š + å’Œ / Base64URL ä½¿ç”¨ä»¥ä¸‹å­—ç¬¦ï¼š - å’Œ _ å¡«å……å­—ç¬¦ Base64 é€šå¸¸ä½¿ç”¨ = ä½œç‚ºå¡«å……å­—ç¬¦ã€‚ Base64URL çœç•¥äº†å¡«å……å­—ç¬¦ã€‚"},{"title":"åœ¨iPhoneä¸Šé‹è¡ŒFlutterå°ˆæ¡ˆ","path":"/2024/08/08/RunFlutterOnIOS/","content":"å‰è¨€å¹³å¸¸åœ¨ VS Code ä¸ŠåŸ·è¡Œå°ˆæ¡ˆçš„æ–¹æ³•ä¸å¤–ä¹å°±æ˜¯å…ˆæ‰“é–‹ IOS Simulatorï¼Œç„¶å¾Œå†åˆ° main.dart ä¸­å» Start Debugging å¿«é€Ÿå•Ÿå‹•å°ˆæ¡ˆï¼Œé‚£å¦‚æœè¦åœ¨ iPhone ä¸Šé‹è¡Œå°ˆæ¡ˆï¼Œä¸¦ä¸”èƒ½å¤  hot reloadï¼Œè©²æ€éº¼åšï¼Ÿ æ­¥é©Ÿ å®‰è£ Xcodeï¼šç¢ºä¿ä½ å·²ç¶“å®‰è£äº†æœ€æ–°ç‰ˆæœ¬çš„ Xcodeã€‚ é€£æ¥ iPhoneï¼šä½¿ç”¨ USB æ•¸æ“šç·šå°‡ iPhone é€£æ¥åˆ°ä½ çš„ Macã€‚ æ‰“é–‹ Xcodeï¼šåœ¨å°ˆæ¡ˆä¸­æ‰“ä¸Š open ios/Runner.xcworkspaceé–‹å•Ÿ Xcode ç¢ºä¿é”æˆä»¥ä¸‹æ¢ä»¶ åˆ° VS Code å·¦å´æ¬„ Flutter çš„ Extenstion å…§ï¼Œé¸æ“‡è‡ªå·±è£ç½® å° main.dart æŒ‰ä¸‹ Start Debugging æ­¤æ™‚ï¼Œç¬¬ä¸€æ¬¡åŸ·è¡Œæ‰‹æ©Ÿä¸Šæœƒå‡ºç¾æœªå—ä¿¡ä»»é–‹ç™¼è€…çš„æç¤ºåˆ° è¨­å®š â†’ ä¸€èˆ¬ â†’ VPN èˆ‡è£ç½®ç®¡ç† â†’ ä¿¡ä»»é–‹ç™¼è€… ä¿¡ä»»å¾Œï¼Œé‡æ–°åŸ·è¡Œå°ˆæ¡ˆï¼Œæ‰‹æ©Ÿçš„ APP å°±æœƒæ­£å¸¸å•Ÿå‹•äº†ï¼ åˆ‡æ›æˆå¦ä¸€å€‹å°ˆæ¡ˆå»ä¸èƒ½åŸ·è¡Œï¼Ÿå‡è¨­ç¬¬ä¸€å€‹å°ˆæ¡ˆç‚ºçš„åç¨±ç‚º ecommerce_shopï¼Œé‚£é è¨­çš„ Bundle Identifier å°±æœƒæ˜¯com.example.ecommerceShop ï¼Œé€™æ™‚ï¼Œä½ å¦‚æœè¦åˆ‡æ›æˆå¦ä¸€å€‹å°ˆæ¡ˆï¼Œå‡è¨­åç‚º todo_app ï¼Œé€™æ™‚ä»–çš„é è¨­ Bundle Identifier æœƒæ˜¯ com.example.todoApp ï¼Œç­‰æ–¼ä½ çš„å¸³è™Ÿåº•ä¸‹æœ‰å…©å€‹com.exampleï¼Œé€™æ™‚å°±æœƒå‡ºéŒ¯ï¼Œå¦‚ä¸‹åœ– æ‰€ä»¥ä½ è¦å°‡ Bundle Identifier æ”¹æˆå”¯ä¸€æ¨™è­˜ç¬¦ï¼Œä¾‹å¦‚ com.landohsieh.todoApp å¦‚ä¸‹ ç„¶å¾Œå†å»åŸ·è¡Œä¸€æ¬¡å°ˆæ¡ˆï¼Œå°±èƒ½æˆåŠŸåœ¨æ‰‹æ©Ÿä¸Šé‹ä½œå˜ï¼","tags":["Flutter"]},{"title":"å¦‚ä½•åœ¨é é¢å°èˆªæ™‚å‚³éè³‡æ–™","path":"/2024/08/07/Flutter-ModalRoute/","content":"å‰è¨€åœ¨ Flutter ä¸­ï¼Œç•¶ä½ å¾ä¸€å€‹é é¢å°èˆªåˆ°å¦ä¸€å€‹é é¢æ™‚ï¼Œä½ å¯ä»¥å‚³éè³‡æ–™çµ¦ç›®æ¨™é é¢ã€‚é€™å¯ä»¥é€šé Navigator å’Œ ModalRoute ä¾†å¯¦ç¾ã€‚æœ¬æ–‡å°‡ä»‹ç´¹å¦‚ä½•åœ¨é é¢å°èˆªæ™‚å‚³éè³‡æ–™ï¼Œä¸¦å±•ç¤ºå…·é«”çš„ä½¿ç”¨æƒ…å¢ƒå’Œç¨‹å¼ç¢¼ç¯„ä¾‹ã€‚ ä½¿ç”¨æƒ…å¢ƒå‡è¨­ä½ æœ‰ä¸€å€‹æ‡‰ç”¨ç¨‹åºï¼Œå®ƒæœƒæ¥æ”¶æ¨é€é€šçŸ¥ã€‚ç•¶ç”¨æˆ¶é»æ“Šé€šçŸ¥æ™‚ï¼Œä½ å¸Œæœ›å°èˆªåˆ°ä¸€å€‹ç‰¹å®šçš„é é¢ä¸¦é¡¯ç¤ºé€šçŸ¥çš„å…§å®¹ã€‚ æ­¥é©Ÿ è¨­ç½®å°èˆªè·¯ç”±ï¼šåœ¨ MaterialApp ä¸­è¨­ç½®å°èˆªè·¯ç”±ã€‚ å°èˆªä¸¦å‚³éè³‡æ–™ï¼šä½¿ç”¨ Navigator.pushNamed æ–¹æ³•å°èˆªåˆ°ç›®æ¨™é é¢ä¸¦å‚³éè³‡æ–™ã€‚ æ¥æ”¶è³‡æ–™ï¼šåœ¨ç›®æ¨™é é¢ä¸­ä½¿ç”¨ ModalRoute ä¾†æ¥æ”¶å‚³ééä¾†çš„è³‡æ–™ã€‚ ç¨‹å¼ç¢¼ç¯„ä¾‹1. è¨­ç½®å°èˆªè·¯ç”±åœ¨ main.dart ä¸­è¨­ç½®å°èˆªè·¯ç”±ï¼š 123456789101112131415161718192021222324252627282930313233import &#x27;package:flutter/material.dart&#x27;;import &#x27;package:firebase_messaging/firebase_messaging.dart&#x27;;void main() &#123; runApp(MyApp());&#125;class MyApp extends StatelessWidget &#123; @override Widget build(BuildContext context) &#123; return MaterialApp( home: HomePage(), routes: &#123; &#x27;/notification_screen&#x27;: (context) =&gt; const NotificationPage(), &#125;, ); &#125;&#125;class HomePage extends StatelessWidget &#123; @override Widget build(BuildContext context) &#123; return Scaffold( appBar: AppBar( title: Text(&quot;Home Page&quot;), ), body: Center( child: Text(&quot;Welcome to Home Page&quot;), ), ); &#125;&#125; 2. å°èˆªä¸¦å‚³éè³‡æ–™å‡è¨­ä½ åœ¨æŸå€‹åœ°æ–¹æ¥æ”¶åˆ°æ¨é€é€šçŸ¥ï¼Œä¸¦å¸Œæœ›å°èˆªåˆ° NotificationPageï¼š 12345678910111213141516final navigatorKey = GlobalKey&lt;NavigatorState&gt;();void handleMessage(RemoteMessage? message) &#123; if (message == null) return; navigatorKey.currentState?.pushNamed( &#x27;/notification_screen&#x27;, arguments: message, );&#125;Future initPushNotifications() async &#123; FirebaseMessaging.instance.getInitialMessage().then(handleMessage); FirebaseMessaging.onMessageOpenedApp.listen(handleMessage);&#125; 3. æ¥æ”¶è³‡æ–™åœ¨ NotificationPage ä¸­ä½¿ç”¨ ModalRoute ä¾†æ¥æ”¶å‚³ééä¾†çš„è³‡æ–™ï¼š 1234567891011121314151617181920class NotificationPage extends StatelessWidget &#123; const NotificationPage(&#123;super.key&#125;); @override Widget build(BuildContext context) &#123; final message = ModalRoute.of(context)?.settings.arguments as RemoteMessage?; return Scaffold( appBar: AppBar( title: Text(&quot;Notification Page&quot;), ), body: Center( child: message != null ? Text(&quot;Message: $&#123;message.notification?.title ?? &#x27;No Title&#x27;&#125;&quot;) : Text(&quot;No message received&quot;), ), ); &#125;&#125; ç¸½çµ è¨­ç½®å°èˆªè·¯ç”±ï¼šåœ¨ MaterialApp ä¸­è¨­ç½®å°èˆªè·¯ç”±ï¼Œå®šç¾©é é¢è·¯å¾‘å’Œå°æ‡‰çš„é é¢å°éƒ¨ä»¶ã€‚ å°èˆªä¸¦å‚³éè³‡æ–™ï¼šä½¿ç”¨ Navigator.pushNamed æ–¹æ³•å°èˆªåˆ°ç›®æ¨™é é¢ï¼Œä¸¦é€šé arguments å‚³éè³‡æ–™ã€‚ æ¥æ”¶è³‡æ–™ï¼šåœ¨ç›®æ¨™é é¢ä¸­ä½¿ç”¨ ModalRoute.of(context)?.settings.arguments ä¾†æ¥æ”¶å‚³ééä¾†çš„è³‡æ–™ã€‚ é€™æ¨£ï¼Œä½ å°±å¯ä»¥åœ¨é é¢å°èˆªæ™‚å‚³éè³‡æ–™ï¼Œä¸¦åœ¨ç›®æ¨™é é¢ä¸­ä½¿ç”¨é€™äº›è³‡æ–™ã€‚","tags":["Flutter"]},{"title":"ECDHåŠ å¯†æ­é…JWTæå‡å®‰å…¨æ€§","path":"/2024/08/05/JWT-ECDH/","content":"å‰è¨€ä¸€èˆ¬ç”Ÿæˆ JWT æ™‚ï¼Œéƒ½æ˜¯é€éè¨­å®šå¥½çš„å›ºå®šå­—ä¸²ç•¶ä½œ JWT çš„å¯†é‘°ï¼ˆSecret keyï¼‰ï¼Œç„¶å¾Œå†å°‡ JWT å‚³é€åˆ°å¾Œç«¯ï¼Œä¸¦ç”¨ç›¸åŒçš„ Secret key å»åšé©—è­‰ï¼Œä½†é€™æ¨£çš„åšæ³•å®‰å…¨æ€§ç›¸å°è¼ƒä½ï¼Œå¦‚æœå›ºå®šçš„ Secret Key è¢«æ´©æ¼ï¼Œæ”»æ“Šè€…å¯ä»¥å½é€  JWTï¼Œä¸¦ä¸”ç„¡æ³•é˜²æ­¢é‡æ”¾æ”»æ“Šã€‚ ç•¶ä½¿ç”¨ JWTï¼ˆJSON Web Tokenï¼‰æ­é… ECDHï¼ˆæ©¢åœ“æ›²ç·š Diffie-Hellmanï¼‰å¯†é‘°äº¤æ›ä¾†æå‡å®‰å…¨æ€§æ™‚ï¼Œä¸»è¦ç›®çš„æ˜¯åˆ©ç”¨ ECDH ç”Ÿæˆçš„å…±äº«ç§˜å¯†å¯†é‘°ä¾†ç°½åå’Œé©—è­‰ JWTã€‚é€™æ¨£å¯ä»¥ç¢ºä¿ JWT çš„å®Œæ•´æ€§å’Œä¾†æºçš„å¯ä¿¡æ€§ï¼Œä¸¦ä¸”åœ¨é€šä¿¡éç¨‹ä¸­ä¸æœƒæš´éœ²å¯¦éš›çš„ç°½åå¯†é‘°ã€‚ æ­¤ç¯‡å°‡æ¢è¨å¦‚ä½•ä½¿ç”¨ ECDH æ©¢åœ“æ›²ç·šé€²è¡Œå¯†é‘°äº¤æ›ç”Ÿæˆ Secret Key æå‡ JWT çš„å®‰å…¨æ€§ã€‚ ä½¿ç”¨æƒ…å¢ƒå‡è¨­æœ‰ä¸€å€‹ IoT è¨­å‚™ï¼ˆDeviceï¼‰éœ€è¦å°é›²ç«¯æœå‹™ï¼ˆServerï¼‰ç™¼é€ API è«‹æ±‚ï¼Œè«‹æ±‚ä¸­éœ€è¦åŒ…å«ç”Ÿæˆçš„ JTWï¼Œé€é JWT é©—è­‰è«‹æ±‚æ˜¯å¦æœ‰æ•ˆã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹å…·é«”çš„ä½¿ç”¨æƒ…å¢ƒï¼š Device åˆå§‹åŒ–ï¼šç¬¬ä¸€æ¬¡å•Ÿç”¨ Device æ™‚è¦åšçš„äº‹ Device ä¸­ç”Ÿæˆä¸€å° ECC å¯†é‘°å°ï¼ˆdPubå’ŒdPriï¼‰ï¼Œä¸¦å°‡ dPub å‚³é€åˆ°å¾Œç«¯ DB å„²å­˜ã€‚ï¼ˆæ¯å€‹ Device éƒ½æœ‰ä¸€å€‹å„²å­˜è‡ªå·± dPub çš„æ¬„ä½ï¼‰ Server ä¸­ç”Ÿæˆä¸€å° ECC å¯†é‘°å°ï¼ˆsPubå’ŒsPriï¼‰ï¼Œå°‡ sPub å‚³é€çµ¦ Device ä¸­å„²å­˜ï¼ˆäº¦å¯ç›´æ¥ç·¨è­¯åœ¨ Device å…§ï¼‰ é€™æ¨£ Server ç«¯å°±æœƒæœ‰ dPub, sPub, sPri ä¸‰å€‹ï¼Œè€Œ Device å…§å°±æœƒæœ‰ dPub, dPri, sPub ä¸‰å€‹ ç•¶ Device è¦å° Server ç™¼é€ API è«‹æ±‚æ™‚ Device é€édPriè·ŸsPubç”Ÿæˆå…±äº«å¯†é‘° (Secret Key) Device ç”¨é€™å€‹ Secret key è·Ÿ Payload ç°½å JWT (payload ä¸­åŒ…å« Device UUID) Device å°‡ç°½åå¥½çš„ JWT ç™¼é€åˆ° Server Server æ”¶åˆ° JWT å¾Œï¼Œå°‡ sPrièˆ‡dPubç”Ÿæˆå…±äº«å¯†é‘° (Secret Key) Server ç”¨é€™çµ„å¯†é‘°é©—è­‰ JWT æ˜¯å¦æœ‰æ•ˆï¼Œæœ‰æ•ˆå‰‡è™•ç† request å…·é«”æ­¥é©Ÿèˆ‡ç¨‹å¼ç¢¼ç¯„ä¾‹ä¸‹é¢å°±ç”¨ ASP.NET ä¾†åšå€‹ç¯„ä¾‹ï¼Œç”¨æ–¼ç”Ÿæˆå’Œé©—è­‰ä½¿ç”¨ ECDH å¯†é‘°äº¤æ›çš„ JWTï¼š 1. ç”Ÿæˆå¯†é‘°å°123456789private static ECDsa _ecdsa;private static ECDsa _ecdsaByDevice;static JwtValidatorController()&#123; // ç•¶Controllerç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨æ™‚ç”ŸæˆECDsaå¯†é‘° _ecdsa = ECDsa.Create(ECCurve.NamedCurves.nistP256); _ecdsaByDevice = ECDsa.Create(ECCurve.NamedCurves.nistP256);&#125; 2. ç”Ÿæˆ Server ç«¯å’Œ Device ç«¯çš„å…¬ç§é‘°å°123456789101112131415161718192021222324252627282930313233343536[HttpGet(&quot;generateKeyByServer&quot;)]public IActionResult GenerateKeys()&#123; byte[] publicKey = _ecdsa.ExportSubjectPublicKeyInfo(); string publicKeyBase64 = Convert.ToBase64String(publicKey); byte[] privateKey = _ecdsa.ExportPkcs8PrivateKey(); string privateKeyBase64 = Convert.ToBase64String(privateKey); var keys = new &#123; PublicKey = publicKeyBase64, PrivateKey = privateKeyBase64 &#125;; return Ok(keys);&#125;[HttpGet(&quot;generateKeyByDevice&quot;)]public IActionResult GenerateKeysByDevice()&#123; byte[] publicKey = _ecdsaByDevice.ExportSubjectPublicKeyInfo(); string publicKeyBase64 = Convert.ToBase64String(publicKey); byte[] privateKey = _ecdsaByDevice.ExportPkcs8PrivateKey(); string privateKeyBase64 = Convert.ToBase64String(privateKey); var keys = new &#123; PublicKey = publicKeyBase64, PrivateKey = privateKeyBase64 &#125;; return Ok(keys);&#125; 3. å‰µå»º JWT123456789101112131415161718192021222324252627282930313233public class CreateJwtRequest&#123; public string ServerPublicKey &#123; get; set; &#125; public string DevciePrivateKey &#123; get; set; &#125;&#125;[HttpPost(&quot;create-jwt&quot;)]public IActionResult CreateJwt([FromBody] CreateJwtRequest request)&#123; var diffieHellmanA = ECDiffieHellman.Create(); diffieHellmanA.ImportSubjectPublicKeyInfo(Convert.FromBase64String(request.ServerPublicKey), out _); var diffieHellmanB = ECDiffieHellman.Create(); diffieHellmanB.ImportPkcs8PrivateKey(Convert.FromBase64String(request.DevciePrivateKey), out _); var derivedKey = diffieHellmanB.DeriveKeyMaterial(diffieHellmanA.PublicKey); var signingCredentials = new SigningCredentials(new SymmetricSecurityKey(derivedKey), SecurityAlgorithms.HmacSha256); var header = new JwtHeader(signingCredentials); var payload = new JwtPayload &#123; &#123; JwtRegisteredClaimNames.Sub, &quot;testuser&quot; &#125;, &#123; JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString() &#125;, &#123; &quot;exp&quot;, DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeSeconds() &#125; &#125;; var token = new JwtSecurityToken(header, payload); var tokenHandler = new JwtSecurityTokenHandler(); string jwt = tokenHandler.WriteToken(token); return Ok(new &#123; Token = jwt &#125;);&#125; 4. é©—è­‰ JWT1234567891011121314151617181920212223242526272829303132333435363738394041public class VaildateJwtKey&#123; public string Jwt &#123; get; set; &#125; public string DevicePublicKey &#123; get; set; &#125; public string ServerPrivateKey &#123; get; set; &#125;&#125;[HttpPost(&quot;validate-jwt&quot;)]public IActionResult ValidateJwt([FromBody] VaildateJwtKey request)&#123; var tokenHandler = new JwtSecurityTokenHandler(); var jwtToken = tokenHandler.ReadJwtToken(request.Jwt); var diffieHellmanA = ECDiffieHellman.Create(); diffieHellmanA.ImportPkcs8PrivateKey(Convert.FromBase64String(request.ServerPrivateKey), out _); var diffieHellmanB = ECDiffieHellman.Create(); diffieHellmanB.ImportSubjectPublicKeyInfo(Convert.FromBase64String(request.DevicePublicKey), out _); var derivedKey = diffieHellmanA.DeriveKeyMaterial(diffieHellmanB.PublicKey); var validationParameters = new TokenValidationParameters &#123; ValidateIssuer = false, ValidateAudience = false, ValidateLifetime = true, IssuerSigningKey = new SymmetricSecurityKey(derivedKey) &#125;; try &#123; var principal = tokenHandler.ValidateToken(request.Jwt, validationParameters, out var validatedToken); var claims = principal.Claims.Select(c =&gt; new &#123; c.Type, c.Value &#125;); return Ok(new &#123; Valid = true, Claims = claims &#125;); &#125; catch (Exception ex) &#123; return BadRequest(new &#123; Valid = false, Error = ex.Message &#125;); &#125;&#125; é€™æ¨£ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ ECDH å¯†é‘°äº¤æ›ä¾†ç”Ÿæˆå…±äº«çš„ç§˜å¯†å¯†é‘°ï¼Œä¸¦ä½¿ç”¨è©²å¯†é‘°ä¾†ç°½åå’Œé©—è­‰ JWTï¼Œå¾è€Œæå‡ JWT çš„å®‰å…¨æ€§ã€‚ ECDH å¯†é‘°äº¤æ›å„ªç¼ºé»å„ªé»é«˜å®‰å…¨æ€§ï¼šâ—¦ ECDH å¯†é‘°äº¤æ›å”è­°ç¢ºä¿åªæœ‰é€šä¿¡é›™æ–¹èƒ½ç”Ÿæˆç›¸åŒçš„å…±äº«ç§˜å¯†å¯†é‘°ï¼Œç¬¬ä¸‰æ–¹ç„¡æ³•ç²å–é€™å€‹å¯†é‘°ã€‚â—¦ æ¯æ¬¡é€šä¿¡éƒ½å¯ä»¥ç”Ÿæˆæ–°çš„å…±äº«ç§˜å¯†å¯†é‘°ï¼Œé˜²æ­¢é‡æ”¾æ”»æ“Šã€‚ å‹•æ…‹å¯†é‘°ç”Ÿæˆï¼šâ—¦ æ¯æ¬¡é€šä¿¡éƒ½å¯ä»¥ç”Ÿæˆæ–°çš„å…±äº«ç§˜å¯†å¯†é‘°ï¼Œé€²ä¸€æ­¥æé«˜å®‰å…¨æ€§ã€‚ é˜²ç¯¡æ”¹å’Œå½é€ ï¼šâ—¦ ç”±æ–¼å¯†é‘°äº¤æ›éç¨‹ä¸­ä¸å‚³è¼¸ç§é‘°ï¼Œæ”»æ“Šè€…ç„¡æ³•å½é€  JWTã€‚ ç¼ºé»å¯¦ç¾è¤‡é›œï¼šâ—¦ éœ€è¦å¯¦ç¾ ECDH å¯†é‘°äº¤æ›å”è­°ï¼Œå¢åŠ äº†å¯¦ç¾çš„è¤‡é›œæ€§ã€‚â—¦ éœ€è¦ç®¡ç†å…¬ç§é‘°å°ï¼Œå¢åŠ äº†é–‹ç™¼å’Œé‹ç¶­çš„è² æ“”ã€‚ æ€§èƒ½è¼ƒä½ï¼šâ—¦ ç”Ÿæˆå’Œé©—è­‰ JWT çš„éç¨‹ä¸­éœ€è¦é€²è¡Œè¤‡é›œçš„è¨ˆç®—ï¼Œæ€§èƒ½è¼ƒä½ã€‚ ç¸½çµä½¿ç”¨ ECDH å¯†é‘°äº¤æ›ä¾†ç”Ÿæˆå…±äº«çš„ç§˜å¯†å¯†é‘°ï¼Œä¸¦ä½¿ç”¨è©²ç§˜å¯†å¯†é‘°ä¾†ç°½åå’Œé©—è­‰ JWTï¼Œå…·æœ‰ä»¥ä¸‹å„ªé»ï¼š æé«˜å®‰å…¨æ€§ï¼š ECDH å¯†é‘°äº¤æ›ç¢ºä¿åªæœ‰é€šä¿¡é›™æ–¹èƒ½ç”Ÿæˆç›¸åŒçš„å…±äº«ç§˜å¯†å¯†é‘°ï¼Œç¬¬ä¸‰æ–¹ç„¡æ³•ç²å–é€™å€‹å¯†é‘°ã€‚ ä½¿ç”¨å…±äº«çš„ç§˜å¯†å¯†é‘°ä¾†ç°½åå’Œé©—è­‰ JWTï¼Œç¢ºä¿ JWT çš„å®Œæ•´æ€§å’Œä¾†æºçš„å¯ä¿¡æ€§ã€‚ ç°¡åŒ–å¯†é‘°ç®¡ç†ï¼š é›™æ–¹åªéœ€äº¤æ›å…¬é‘°ï¼Œç„¡éœ€å…±äº«ç§é‘°ï¼Œæ¸›å°‘äº†å¯†é‘°ç®¡ç†çš„è¤‡é›œæ€§å’Œé¢¨éšªã€‚ å‹•æ…‹å¯†é‘°ç”Ÿæˆï¼š æ¯æ¬¡é€šä¿¡éƒ½å¯ä»¥ç”Ÿæˆæ–°çš„å…±äº«ç§˜å¯†å¯†é‘°ï¼Œé€²ä¸€æ­¥æé«˜å®‰å…¨æ€§ã€‚","tags":["ASP.NET"]},{"title":"Flutter Riverpod ç‹€æ…‹ç®¡ç†å·¥å…·","path":"/2024/07/24/Flutter-riverpod/","content":"ä»€éº¼æ˜¯ Riverpodï¼ŸRiverpod æ˜¯ç”± Remi Rousselet å‰µå»ºçš„ä¸€å€‹å¼·å¤§ä¸”éˆæ´»çš„ç‹€æ…‹ç®¡ç†è§£æ±ºæ–¹æ¡ˆã€‚å®ƒæ—¨åœ¨è§£æ±º Provider åŒ…çš„ä¸€äº›é™åˆ¶ï¼Œæä¾›æ›´å¥½çš„å¯æ¸¬è©¦æ€§ã€æ›´å¤šçš„éˆæ´»æ€§å’Œæ›´å°‘çš„å…¨å±€ç‹€æ…‹ä¾è³´ã€‚ å®‰è£åœ¨ä½ çš„ Flutter é …ç›®ä¸­æ·»åŠ  flutter_riverpod ä¾è³´é …ã€‚ 1234dependencies: flutter: sdk: flutter flutter_riverpod: ^1.0.0 ç„¶å¾Œé‹è¡Œä»¥ä¸‹å‘½ä»¤ä¾†å®‰è£ä¾è³´é …ï¼š 1flutter pub get åŸºæœ¬ç”¨æ³•1. å‰µå»º ProviderProvider æ˜¯ Riverpod ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œç”¨æ–¼ç®¡ç†æ‡‰ç”¨ç¨‹åºçš„ç‹€æ…‹ã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„è¨ˆæ•¸å™¨ Providerï¼š 123456import &#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;;// å‰µå»ºä¸€å€‹ StateProviderfinal counterProvider = StateProvider&lt;int&gt;((ref) &#123; return 0;&#125;); 2. ä½¿ç”¨ ProviderScopeProviderScope æ˜¯ä¸€å€‹ Widgetï¼Œç”¨æ–¼æä¾›ä¸€å€‹ç‹€æ…‹ä½œç”¨åŸŸï¼Œè©²ä½œç”¨åŸŸå…§çš„æ‰€æœ‰ Provider éƒ½å¯ä»¥å…±äº«ç›¸åŒçš„ç‹€æ…‹ã€‚é€šå¸¸å°‡ ProviderScope æ”¾åœ¨æ‡‰ç”¨ç¨‹åºçš„æ ¹éƒ¨ã€‚ 123456789101112131415161718192021import &#x27;package:flutter/material.dart&#x27;;import &#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;;void main() &#123; runApp( const ProviderScope( child: MyApp(), ), );&#125;class MyApp extends StatelessWidget &#123; const MyApp(&#123;Key? key&#125;) : super(key: key); @override Widget build(BuildContext context) &#123; return MaterialApp( home: HomePage(), ); &#125;&#125; 3. ä½¿ç”¨ ConsumerWidgetConsumerWidget æ˜¯ä¸€å€‹ Widgetï¼Œç”¨æ–¼è¨ªå•å’Œä½¿ç”¨ Provider çš„ç‹€æ…‹ã€‚ä½ å¯ä»¥åœ¨ build æ–¹æ³•ä¸­ä½¿ç”¨ ref.watch ä¾†ç›£è½ Provider çš„ç‹€æ…‹è®ŠåŒ–ï¼Œä¸¦ä½¿ç”¨ ref.read ä¾†æ›´æ–°ç‹€æ…‹ã€‚ 12345678910111213141516171819202122232425262728class HomePage extends ConsumerWidget &#123; @override Widget build(BuildContext context, WidgetRef ref) &#123; // ä½¿ç”¨ Provider ä¾†è¨ªå•ç‹€æ…‹ final counter = ref.watch(counterProvider); return Scaffold( appBar: AppBar( title: Text(&#x27;Riverpod Example&#x27;), ), body: Center( child: Column( mainAxisAlignment: MainAxisAlignment.center, children: [ Text(&#x27;Counter: $counter&#x27;), ElevatedButton( onPressed: () &#123; // ä½¿ç”¨ Provider ä¾†æ›´æ–°ç‹€æ…‹ ref.read(counterProvider.state).state++; &#125;, child: Text(&#x27;Increment&#x27;), ), ], ), ), ); &#125;&#125; é€²éšç”¨æ³•1. ä½¿ç”¨ StateNotifierProviderStateNotifierProvider ç”¨æ–¼ç®¡ç†æ›´è¤‡é›œçš„ç‹€æ…‹ã€‚ä½ å¯ä»¥å‰µå»ºä¸€å€‹ StateNotifier é¡ä¾†ç®¡ç†ç‹€æ…‹ï¼Œä¸¦ä½¿ç”¨ StateNotifierProvider æä¾›é€™å€‹ç‹€æ…‹ã€‚ 12345678910111213import &#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;;// å‰µå»ºä¸€å€‹ StateNotifier é¡class CounterNotifier extends StateNotifier&lt;int&gt; &#123; CounterNotifier() : super(0); void increment() =&gt; state++;&#125;// å‰µå»ºä¸€å€‹ StateNotifierProviderfinal counterNotifierProvider = StateNotifierProvider&lt;CounterNotifier, int&gt;((ref) &#123; return CounterNotifier();&#125;); 2. ä½¿ç”¨ Provider é¡å‹Riverpod æä¾›äº†å¤šç¨® Provider é¡å‹ä¾†ç®¡ç†ä¸åŒçš„ç‹€æ…‹ï¼š Providerï¼šç”¨æ–¼æä¾›åªè®€çš„ç‹€æ…‹ã€‚StateProviderï¼šç”¨æ–¼æä¾›å¯è®Šçš„ç‹€æ…‹ã€‚FutureProviderï¼šç”¨æ–¼ç®¡ç†ç•°æ­¥ç‹€æ…‹ã€‚StreamProviderï¼šç”¨æ–¼ç®¡ç†æµç‹€æ…‹ã€‚StateNotifierProviderï¼šç”¨æ–¼ç®¡ç†æ›´è¤‡é›œçš„ç‹€æ…‹ã€‚ ç¨‹å¼ç¯„ä¾‹ä»¥ä¸‹æ˜¯ä¸€å€‹å®Œæ•´çš„ç¯„ä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ StateNotifierProvider ä¾†ç®¡ç†è¨ˆæ•¸å™¨ç‹€æ…‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import &#x27;package:flutter/material.dart&#x27;;import &#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;;// å‰µå»ºä¸€å€‹ StateNotifier é¡class CounterNotifier extends StateNotifier&lt;int&gt; &#123; CounterNotifier() : super(0); void increment() =&gt; state++;&#125;// å‰µå»ºä¸€å€‹ StateNotifierProviderfinal counterNotifierProvider = StateNotifierProvider&lt;CounterNotifier, int&gt;((ref) &#123; return CounterNotifier();&#125;);void main() &#123; runApp( const ProviderScope( child: MyApp(), ), );&#125;class MyApp extends StatelessWidget &#123; const MyApp(&#123;Key? key&#125;) : super(key: key); @override Widget build(BuildContext context) &#123; return MaterialApp( home: HomePage(), ); &#125;&#125;class HomePage extends ConsumerWidget &#123; @override Widget build(BuildContext context, WidgetRef ref) &#123; // ä½¿ç”¨ Provider ä¾†è¨ªå•ç‹€æ…‹ final counter = ref.watch(counterNotifierProvider); return Scaffold( appBar: AppBar( title: Text(&#x27;Riverpod Example&#x27;), ), body: Center( child: Column( mainAxisAlignment: MainAxisAlignment.center, children: [ Text(&#x27;Counter: $counter&#x27;), ElevatedButton( onPressed: () &#123; // ä½¿ç”¨ Provider ä¾†æ›´æ–°ç‹€æ…‹ ref.read(counterNotifierProvider.notifier).increment(); &#125;, child: Text(&#x27;Increment&#x27;), ), ], ), ), ); &#125;&#125; ç¸½çµProviderScopeï¼šæä¾›ä¸€å€‹ç‹€æ…‹ä½œç”¨åŸŸï¼Œè©²ä½œç”¨åŸŸå…§çš„æ‰€æœ‰ Provider éƒ½å¯ä»¥å…±äº«ç›¸åŒçš„ç‹€æ…‹ã€‚Provider é¡å‹ï¼šåŒ…æ‹¬ Providerã€StateProviderã€FutureProviderã€StreamProvider å’Œ StateNotifierProviderã€‚","tags":["Flutter Package"]},{"title":"Dartä¸­çš„constå¸¸é‡","path":"/2024/07/18/dart-const/","content":"ä»€éº¼æ˜¯ conståœ¨ Dart å’Œ Flutter ä¸­ï¼Œconsté—œéµå­—ç”¨æ–¼å‰µå»ºç·¨è­¯æ™‚æœŸå¸¸é‡ã€‚é€™æ„å‘³è‘—åœ¨ç·¨è­¯æ™‚æœŸå°±ç¢ºå®šäº†å°è±¡çš„å€¼ï¼Œä¸¦ä¸”åœ¨é‹è¡Œæ™‚æœŸç„¡æ³•æ›´æ”¹ã€‚ const çš„å„ªé»1. æå‡æ•ˆèƒ½ ä½¿ç”¨ const å¯ä»¥æå‡æ•ˆèƒ½ï¼Œå› ç‚ºå¸¸é‡å°è±¡åœ¨å…§å­˜ä¸­åªæœƒå‰µå»ºä¸€æ¬¡ï¼Œä¸¦ä¸”åœ¨å¤šå€‹åœ°æ–¹é‡ç”¨ã€‚é€™æ¸›å°‘äº†å…§å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶çš„é–‹éŠ·ã€‚ 2. ä¿è­‰ä¸å¯è®Šæ€§ const ä¿è­‰å°è±¡åœ¨å‰µå»ºå¾Œç„¡æ³•æ›´æ”¹ï¼Œé€™æœ‰åŠ©æ–¼é¿å…æ„å¤–çš„ç‹€æ…‹è®Šæ›´ï¼Œä¸¦æé«˜ä»£ç¢¼çš„ç©©å®šæ€§å’Œå¯é æ¸¬æ€§ã€‚ ä½¿ç”¨ const çš„æ³¨æ„äº‹é …1. æ‰€æœ‰å­—æ®µå¿…é ˆæ˜¯ final ç•¶ä½ ç‚ºä¸€å€‹é¡å®šç¾© const æ§‹é€ å‡½æ•¸æ™‚ï¼Œè©²é¡ä¸­çš„æ‰€æœ‰å­—æ®µå¿…é ˆæ˜¯ finalï¼Œå› ç‚º const æ§‹é€ å‡½æ•¸è¦æ±‚å°è±¡åœ¨ç·¨è­¯æ™‚æœŸç¢ºå®šæ‰€æœ‰å±¬æ€§ã€‚ 123456789101112131415class MyButton extends StatelessWidget &#123; final String text; final VoidCallback onPressed; const MyButton(&#123; super.key, required this.text, required this.onPressed, &#125;); @override Widget build(BuildContext context) &#123; return const Placeholder(); &#125;&#125; 2. åµŒå¥—çš„ const å¦‚æœä¸€å€‹ const å°è±¡åŒ…å«å…¶ä»–å°è±¡ï¼Œé€™äº›å°è±¡ä¹Ÿå¿…é ˆæ˜¯ constã€‚é€™æ¨£å¯ä»¥ç¢ºä¿æ•´å€‹å°è±¡æ¨¹åœ¨ç·¨è­¯æ™‚æœŸéƒ½æ˜¯å¸¸é‡ã€‚ 12345const myList = [ const Text(&#x27;Item 1&#x27;), const Text(&#x27;Item 2&#x27;), const Text(&#x27;Item 3&#x27;),]; 3. ä½¿ç”¨ const æ§‹é€ å‡½æ•¸ åœ¨ Flutter ä¸­ï¼Œè¨±å¤š widget å¯ä»¥ä½¿ç”¨ const æ§‹é€ å‡½æ•¸ä¾†å‰µå»ºä¸å¯è®Šçš„ widget æ¨¹ã€‚é€™æœ‰åŠ©æ–¼æé«˜æ•ˆèƒ½ï¼Œå› ç‚ºå¸¸é‡ widget ä¸éœ€è¦é‡æ–°æ§‹å»ºã€‚ 123456789101112@overrideWidget build(BuildContext context) &#123; return const Scaffold( appBar: AppBar( title: Text(&#x27;My App&#x27;), ), body: Center( child: Text(&#x27;Hello, World!&#x27;), ), );&#125; 4. ä½¿ç”¨ const é—œéµå­— åœ¨å‰µå»ºå¸¸é‡å°è±¡æ™‚ï¼Œç¢ºä¿åœ¨æ§‹é€ å‡½æ•¸å‰æ·»åŠ  const é—œéµå­—ã€‚é€™æ¨£å¯ä»¥æ˜ç¢ºè¡¨ç¤ºè©²å°è±¡æ˜¯å¸¸é‡ã€‚ 123456const myButton = MyButton( text: &#x27;Click Me&#x27;, onPressed: () &#123; print(&#x27;Button Pressed!&#x27;); &#125;,);","tags":["dart"]},{"title":"Future voidÂ vsÂ voidÂ in Dart","path":"/2024/07/18/dart-future-void/","content":"FutureÂ vsÂ voidÂ in Dart1. æ¦‚è¿°åœ¨ Dart ä¸­ï¼ŒFuture&lt;void&gt; å’Œ void éƒ½å¯ä»¥ç”¨ä¾†å®šç¾©æ–¹æ³•çš„è¿”å›é¡å‹ï¼Œä½†å®ƒå€‘æœ‰ä¸åŒçš„ç”¨é€”å’Œè¡Œç‚ºã€‚ç†è§£é€™å…©è€…çš„å€åˆ¥å°æ–¼ç·¨å¯«æ¸…æ™°ã€å¯ç¶­è­·å’Œæ­£ç¢ºçš„ç•°æ­¥ç¨‹å¼ç¢¼è‡³é—œé‡è¦ã€‚ 2.Â Future&lt;void&gt;å®šç¾©Future&lt;void&gt; è¡¨ç¤ºä¸€å€‹ç•°æ­¥æ“ä½œï¼Œé€™å€‹æ“ä½œåœ¨å®Œæˆæ™‚ä¸æœƒè¿”å›ä»»ä½•å€¼ã€‚å®ƒå…è¨±èª¿ç”¨è€…ç­‰å¾…æ“ä½œå®Œæˆä¸¦é€²è¡ŒéŒ¯èª¤è™•ç†ã€‚ ä½¿ç”¨æƒ…å¢ƒç•¶æ–¹æ³•éœ€è¦åŸ·è¡Œç•°æ­¥æ“ä½œä¸¦ä¸”èª¿ç”¨è€…éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆæ™‚ã€‚ç•¶æ–¹æ³•å¯èƒ½æœƒæ‹‹å‡ºç•°æ­¥éŒ¯èª¤ä¸¦ä¸”éœ€è¦éŒ¯èª¤è™•ç†æ™‚ã€‚ ç¯„ä¾‹1234567891011Future&lt;void&gt; fetchData() async &#123; // æ¨¡æ“¬ä¸€å€‹ç•°æ­¥æ“ä½œï¼Œä¾‹å¦‚ç¶²çµ¡è«‹æ±‚ await Future.delayed(Duration(seconds: 2)); print(&#x27;Data fetched&#x27;);&#125;void main() async &#123; print(&#x27;Fetching data...&#x27;); await fetchData(); print(&#x27;Data fetch complete&#x27;);&#125; é‡é»æ˜ç¢ºçš„ç•°æ­¥æ“ä½œï¼šFuture&lt;void&gt; æ˜ç¢ºè¡¨ç¤ºé€™æ˜¯ç•°æ­¥æ“ä½œã€‚ç­‰å¾…ç•°æ­¥æ“ä½œå®Œæˆï¼šèª¿ç”¨è€…å¯ä»¥ä½¿ç”¨ await ç­‰å¾…æ“ä½œå®Œæˆã€‚éŒ¯èª¤è™•ç†ï¼šèª¿ç”¨è€…å¯ä»¥ä½¿ç”¨ try-catch é€²è¡ŒéŒ¯èª¤è™•ç†ã€‚ 3.Â voidå®šç¾©void è¡¨ç¤ºæ–¹æ³•ä¸æœƒè¿”å›ä»»ä½•å€¼ã€‚é€™é€šå¸¸ç”¨æ–¼åŒæ­¥æ–¹æ³•ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨æ–¼ç•°æ­¥æ–¹æ³•ï¼ˆä¸æ¨è–¦ï¼‰ã€‚ ä½¿ç”¨æƒ…å¢ƒç•¶æ–¹æ³•æ˜¯åŒæ­¥çš„ä¸¦ä¸”ä¸éœ€è¦è¿”å›å€¼æ™‚ã€‚ç•¶æ–¹æ³•æ˜¯ç•°æ­¥çš„ä½†èª¿ç”¨è€…ä¸éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆï¼ˆä¸æ¨è–¦ï¼‰ã€‚ ç¯„ä¾‹1234567void printMessage() &#123; print(&#x27;Hello, World!&#x27;);&#125;void main() &#123; printMessage();&#125; é‡é»åŒæ­¥æ“ä½œï¼šé€šå¸¸ç”¨æ–¼åŒæ­¥æ–¹æ³•ã€‚ç„¡æ³•ç­‰å¾…ç•°æ­¥æ“ä½œå®Œæˆï¼šå¦‚æœç”¨æ–¼ç•°æ­¥æ–¹æ³•ï¼Œèª¿ç”¨è€…ç„¡æ³•ç­‰å¾…æ“ä½œå®Œæˆï¼Œå¯èƒ½å°è‡´ç«¶æ…‹æ¢ä»¶ã€‚ 4. æ¯”è¼ƒ ç‰¹æ€§ Future&lt;void&gt; void è¿”å›é¡å‹ ç•°æ­¥æ“ä½œï¼Œä¸è¿”å›å€¼ åŒæ­¥æ“ä½œï¼Œä¸è¿”å›å€¼ ç­‰å¾…æ“ä½œå®Œæˆ å¯ä»¥ä½¿ç”¨ await ç­‰å¾…æ“ä½œå®Œæˆ ç„¡æ³•ç­‰å¾…æ“ä½œå®Œæˆ éŒ¯èª¤è™•ç† å¯ä»¥ä½¿ç”¨ try-catch é€²è¡ŒéŒ¯èª¤è™•ç† åªèƒ½è™•ç†åŒæ­¥éŒ¯èª¤ ä½¿ç”¨æƒ…å¢ƒ ç•¶éœ€è¦åŸ·è¡Œç•°æ­¥æ“ä½œä¸¦ç­‰å¾…å®Œæˆæ™‚ ç•¶æ–¹æ³•æ˜¯åŒæ­¥ä¸”ä¸éœ€è¦è¿”å›å€¼æ™‚ å…¸å‹ç¯„ä¾‹ ç¶²çµ¡è«‹æ±‚ã€æ–‡ä»¶æ“ä½œç­‰ç•°æ­¥æ“ä½œ æ‰“å°æ¶ˆæ¯ã€è¨ˆç®—ç­‰åŒæ­¥æ“ä½œ 5. ç¸½çµFuture&lt;void&gt;ï¼šé©ç”¨æ–¼ç•°æ­¥æ“ä½œï¼Œå…è¨±èª¿ç”¨è€…ç­‰å¾…æ“ä½œå®Œæˆä¸¦é€²è¡ŒéŒ¯èª¤è™•ç†ã€‚æ‡‰è©²ç”¨æ–¼éœ€è¦ç•°æ­¥åŸ·è¡Œçš„ä»»å‹™ã€‚voidï¼šé©ç”¨æ–¼åŒæ­¥æ“ä½œï¼Œä¸å…è¨±èª¿ç”¨è€…ç­‰å¾…æ“ä½œå®Œæˆã€‚æ‡‰è©²ç”¨æ–¼ä¸éœ€è¦è¿”å›å€¼çš„åŒæ­¥æ–¹æ³•ã€‚","tags":["dart"]},{"title":"CAPå®šç†-åˆ†æ•£å¼ç³»çµ±","path":"/2024/03/25/CAP theorem/","content":"CAPä¸»è¦æ˜¯æ¢è¨ è³‡æ–™åˆ†å€ (Partition) çš„å•é¡Œï¼Œç•¶ç‚ºäº†åˆ†æ•£æµé‡è™•ç†è€Œæ–°å¢å¤šå€‹è³‡æ–™åº«ç¯€é»æ™‚ï¼Œæ¯å€‹ç¯€é»çš„è³‡æ–™å‹¢å¿…è¦ä¿æŒä¸€è‡´ï¼Œæ‰ä¸æœƒå°è‡´æœ‰æ™‚ä½¿ç”¨è€…å–å¾—åˆ°çš„æ˜¯æœ€æ–°è³‡æ–™ï¼Œæœ‰æ™‚å–å¾—åˆ°èˆŠè³‡æ–™ï¼Œä½†ä¸–ç•Œä¸Šä¸å­˜åœ¨100%ç©©å®šçš„ç¶²è·¯ï¼Œæœ‰æ™‚æœƒå› ç‚ºå»¶é²æˆ–æ–·ç·šå°è‡´è³‡æ–™åº«ä¹‹é–“çš„è³‡æ–™ä¸ä¸€è‡´ï¼Œé€™å°±æ˜¯CAPä¸»è¦æ¢è¨çš„è­°é¡Œã€‚ CAPå®šç¾©CAPä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç¨®æ¢ä»¶ C ä¸€è‡´æ€§ (Consistency)ï¼šä½¿ç”¨è€…Alwaysæ‹¿åˆ°æœ€æ–°çš„è³‡æ–™ï¼Œæ‰€æœ‰åˆ†æ•£å¼ç¯€é»å°åŒä¸€ä»½è³‡æ–™çš„è®€å–æ“ä½œï¼Œéƒ½æ‡‰è©²è¿”å›ç›¸åŒçš„å€¼ã€‚ A å¯ç”¨æ€§ (Availability) : ä½¿ç”¨è€…Alwaysåœ¨æœ‰é™æ™‚é–“å…§å¾—åˆ°å›æ‡‰ã€‚ P åˆ†å€å®¹éŒ¯æ€§ (Partition tolerance) : å³ä½¿ç™¼ç”Ÿç¶²è·¯åˆ†å€ï¼Œç³»çµ±ä¹Ÿæ‡‰è©²è¦èƒ½å¤ ç¹¼çºŒé‹ä½œã€‚ CAPçš„é¸æ“‡CAPå®šç†å‘Šè¨´æˆ‘å€‘ï¼Œåœ¨åˆ†æ•£å¼ç³»çµ±ä¸­ï¼Œä¸å¯èƒ½åŒæ™‚æ»¿è¶³ï¼£ï¼¡ï¼°ä¸‰ç¨®æ¢ä»¶ï¼Œåªèƒ½é¸æ“‡å…¶ä¸­å…©ç¨®æ¢ä»¶ä¾†æ»¿è¶³ã€‚ CA ä¸€è‡´æ€§ã€å¯ç”¨æ€§ï¼ˆæœ€ä¸è€ƒæ…®ï¼‰ä¸è€ƒæ…®CAæ˜¯å› ç‚ºï¼Œè‹¥è¦æ»¿è¶³é€™å…©å€‹æ¢ä»¶ï¼Œå¿…é ˆç¢ºä¿å„å€‹ç¯€é»çš„è³‡æ–™å¿…é ˆ100%åŒæ­¥ï¼Œä¸”100ï¼…å¯ç”¨ä¸å‡ºéŒ¯ï¼Œé€™ä»£è¡¨ç¶²è·¯ç’°å¢ƒå¿…é ˆ100%ç©©å®šæ‰å¯å¯¦ç¾ï¼Œæˆ–æ˜¯ç›´æ¥ä½¿ç”¨å–®ä¸€è³‡æ–™åº«çš„æ¶æ§‹ï¼ˆä¸å¿…è€ƒæ…®è³‡æ–™åº«é–“çš„ç¶²è·¯å•é¡Œï¼‰ï¼Œä½†é€™æ¨£çš„åšæ³•å°±å¤±å»äº†CAPçš„æ„ç¾©ï¼Œå› æ­¤ä¸è€ƒæ…®CAçš„çµ„åˆã€‚ CP ä¸€è‡´æ€§ã€åˆ†å€å®¹éŒ¯æ€§æ¯å€‹ç¯€é»çš„è®€å¯«éƒ½æ˜¯æœ€æ–°çš„è³‡æ–™ï¼Œä¹Ÿå°±æ˜¯é”æˆä¸€è‡´æ€§ï¼Œä½†åˆè¦åœ¨è³‡æ–™åˆ†å€çš„ç‹€æ³ä¸‹è®“ç³»çµ±æ­£å¸¸é‹ä½œï¼Œé€™æ„å‘³è‘—ï¼Œå¿…é ˆçŠ§ç‰²æ‰å¯ç”¨æ€§ï¼ˆAlwayså–å¾—å›æ‡‰ï¼‰ï¼Œç•¶è³‡æ–™åˆ†å€æ™‚ï¼Œæˆ‘å€‘æ²’è¾¦æ³•çµ¦äºˆæœ€æ–°çš„è³‡æ–™ï¼Œå› æ­¤ä½¿ç”¨è€…çš„è«‹æ±‚æœƒç›´æ¥å¤±æ•—ï¼Œæ²’æœ‰ä»»ä½•ä¸€å€‹è³‡æ–™åº«æœƒç‰‡é¢åœ°æ”¹è®Šè³‡æ–™çš„ç‹€æ…‹ã€‚ æˆ‘å€‘ä¿è­‰äº†è³‡æ–™çš„Cï¼ˆä¸€è‡´æ€§ï¼‰ï¼Œä½†çŠ§ç‰²äº†ä½¿ç”¨è€…ç¸½æ˜¯èƒ½å¾—åˆ°å›æ‡‰çš„Aï¼ˆå¯ç”¨æ€§ï¼‰ã€‚ AP å¯ç”¨æ€§ã€åˆ†å€å®¹éŒ¯æ€§ä½¿ç”¨è€…Alwayså¾—åˆ°å›æ‡‰ï¼ŒåŒæ™‚åˆè¦åœ¨è³‡æ–™åˆ†å€ç‹€æ³ä¸‹è®“ç³»çµ±æ­£å¸¸é‹ä½œï¼Œç•¶ä½¿ç”¨è€…è¦æ–°å¢è³‡æ–™åˆ°æŸå€‹è³‡æ–™åº«ç¯€é»ï¼Œä½†å› ç‚ºç¶²è·¯åˆ†å€é€ æˆå…¶ä»–è³‡æ–™åº«æ²’æœ‰å³æ™‚åŒæ­¥ï¼Œç‚ºäº†æ»¿è¶³Alwayså¾—åˆ°å›æ‡‰ï¼Œå› æ­¤çŠ§ç‰²æ‰C (ä¸€è‡´æ€§) ï¼Œä»ç„¶å°‡è³‡æ–™æ›´æ–°è‡³è©²ç¯€é»ã€‚ ä½¿ç”¨å ´åˆå¼·ä¸€è‡´æ€§ (String Consistency)å³ç‚ºCPï¼Œå°æ–¼ä¸€è‡´æ€§è¦æ±‚è¼ƒé«˜ï¼Œå¯ä»¥å®¹å¿æš«æ™‚ä¸å¯ç”¨çš„æ‡‰ç”¨ï¼Œåƒæ˜¯é‡‘èäº¤æ˜“é€™é¡çš„ï¼Œè³‡æ–™éœ€è¦ä¿æŒä¸€è‡´çš„å ´åˆã€‚ æœ€çµ‚ä¸€è‡´æ€§ (Eventually Consistency)å³ç‚ºAPï¼Œé¡§åæ€ç¾©å°±æ˜¯â€œæœ€å¾Œâ€æ‰æœƒä¿æŒä¸€è‡´ï¼Œä¸å¿…è¦æ±‚ç•¶ä¸‹æ¯å€‹è³‡æ–™åº«ç¯€é»çš„è³‡æ–™å°±è¦ç«‹å³ä¸€è‡´ï¼Œåƒæ˜¯é‡åˆ°ç¶²è·¯æš«æ™‚ä¸­æ–·æˆ–å»¶é²ï¼Œæ²’æœ‰å³æ™‚åŒæ­¥è³‡æ–™åˆ°å…¶ä»–è³‡æ–™åº«ï¼Œé‚„æ˜¯å¯ä»¥è®“ä½¿ç”¨è€…ç¹¼çºŒå­˜å–è³‡æ–™å¾—åˆ°å›æ‡‰ï¼ˆä¸æ˜¯æœ€æ–°çš„è³‡æ–™ä¹Ÿæ²’å·®ï¼‰ï¼Œé€™ç¨®æœƒæ‡‰ç”¨åœ¨æ–‡ç« ç•™è¨€ã€å½±ç‰‡è§€çœ‹æ¬¡æ•¸ã€ç¤¾äº¤åª’é«”ã€å…§å®¹è½‰ç™¼ç­‰å ´åˆã€‚","tags":["åˆ†æ•£å¼ç³»çµ±"]},{"title":"å¦‚ä½•æå‡APIå®‰å…¨æ€§","path":"/2024/02/27/API-security/","content":"APIä½œç‚ºè³‡æ–™é€šè¨Šçš„å¤§é–€ï¼Œæˆ‘å€‘æ‡‰è©²é‡è¦–å®ƒçš„å®‰å…¨æ€§ï¼Œå³ä¾¿æœ‰äº›APIå¯ä»¥å¾ˆè¼•é¬†åœ°å»é€²è¡Œèª¿ç”¨ï¼Œä½†ä¸ä»£è¡¨æ‡‰è©²è®“æ‰€æœ‰APIéƒ½ä¸å—é™åˆ¶åœ°è¢«å­˜å–èª¿ç”¨ã€‚ APIå¯ä»¥åšå¾ˆå¤šäº‹ï¼Œè³‡æ–™è«‹æ±‚ã€è™•ç†æ•æ„Ÿè³‡è¨Šã€CRUDè³‡æ–™åº«ï¼Œç”šè‡³å¯ä»¥é€éAPIæ§åˆ¶é›»å­è¨­å‚™ï¼Œå› æ­¤åœ¨APPé–‹ç™¼ä¸Šï¼Œé‡å°APIåšåš´æ ¼çš„èº«ä»½é©—è­‰åŠç®¡ç†å°±æœƒé¡¯å¾—æ ¼å¤–é‡è¦ã€‚ Authentication &amp; Authorizationç•¶æ”¶åˆ°APIè«‹æ±‚æ™‚ï¼Œé€šå¸¸æœƒå…ˆé€²è¡Œ Authenticationä»¥åŠAuthorization èº«ä»½é©—è­‰ä»¥åŠæˆæ¬Šï¼ŒæˆåŠŸæˆæ¬Šæ‰å¯ä»¥é€²è¡Œè«‹æ±‚ï¼Œ Authentication(é©—è­‰ï¼‰: é¡§åæ€ç¾©å°±æ˜¯é©—è­‰ä½¿ç”¨è€…çš„èº«ä»½æ˜¯å¦æ­£ç¢ºï¼Œå¯é€éusername, passwordç­‰æ–¹å¼é€²è¡Œé©—è­‰ï¼Œé€™äº›è³‡è¨Šå¯åœ¨ä½¿ç”¨è€…çš„è«‹æ±‚è³‡è¨Šä¸­å–å¾—ã€‚ Authorization(æˆæ¬Š)ï¼šç•¶èº«ä»½é©—è­‰æˆåŠŸï¼Œå°±èƒ½å°é€²è¡Œæˆæ¬Šï¼Œå›å‚³è³‡æ–™çµ¦ä½¿ç”¨è€…ã€‚ 1. é€éJWTå¯¦ç¾æˆæ¬ŠJWT (Json Web Token)ï¼Œé€šå¸¸åœ¨ä½¿ç”¨è€…æˆåŠŸç™»å…¥å¾Œï¼ˆé©—è­‰å¸³è™Ÿå¯†ç¢¼ï¼‰ï¼Œæœƒé€éJWTç”¢ç”Ÿä¸€çµ„å…·æœ‰æ™‚æ•ˆæ€§çš„Tokençµ¦ä½¿ç”¨è€…ï¼ˆå¯å„²å­˜æ–¼cookiesæˆ–localStorageï¼‰ï¼Œä¹‹å¾Œä½¿ç”¨è€…åœ¨æ“ä½œä¸€äº›åŠŸèƒ½æ™‚å¿…é ˆå°‡tokenä¸€ä¸¦é™„ä¸Šæ‰å¯ä½¿ç”¨ã€‚ ç”ŸæˆJWT ç¨‹å¼ç¯„ä¾‹ 123456789101112131415161718const jwt = require(&#x27;jsonwebtoken&#x27;);// ç”¨æˆ¶è³‡è¨Šï¼Œå¯ä»¥æ˜¯ä»»ä½•ä½ æƒ³è¦å„²å­˜åœ¨ token ä¸­çš„è³‡è¨Šconst user = &#123; id: 1, // å‡è¨­çš„ç”¨æˆ¶ ID username: &quot;exampleUser&quot;, email: &quot;user@example.com&quot;&#125;;// å¯†é‘°ï¼Œç”¨æ–¼ç°½å JWTï¼Œæ‡‰ä¿æŒç§˜å¯†const secretKey = &quot;yourSecretKey&quot;;// ç”Ÿæˆ JWTconst token = jwt.sign(user, secretKey, &#123; expiresIn: &#x27;1h&#x27; // token æœ‰æ•ˆæœŸï¼Œé€™è£¡è¨­ç‚º 1 å°æ™‚&#125;);console.log(token); ç•¶ä½¿ç”¨è€…æ¬²ç™¼é€APIè«‹æ±‚ï¼Œéœ€è¦å°‡ç™»å…¥å¾Œæ‹¿åˆ°çš„tokenä¸€ä½µé™„ä¸Šï¼Œserveræœƒé€éæ­¤tokené€²è¡Œé©—è­‰ï¼Œä¸¦çµ¦äºˆæˆæ¬Šã€‚ é©—è­‰JWT ç¨‹å¼ç¯„ä¾‹ 1234567891011121314151617181920212223// æ›¿æ›æˆä½ çš„å¯†é‘°const secretKey = &quot;yourSecretKey&quot;;// JWT é©—è­‰ Middlewareconst verifyToken = (req, res, next) =&gt; &#123; // å¾è«‹æ±‚é ­éƒ¨å–å¾— token const token = req.headers[&#x27;authorization&#x27;]; if (!token) &#123; return res.status(403).send(&#123; message: &quot;æœªæä¾› token!&quot; &#125;); &#125; try &#123; // é©—è­‰ token const decoded = jwt.verify(token, secretKey); // å°‡ç”¨æˆ¶è³‡è¨Šé™„åŠ åˆ°è«‹æ±‚å°è±¡ req.user = decoded; next(); &#125; catch (error) &#123; // å¦‚æœé©—è­‰å¤±æ•—ï¼Œè¿”å›éŒ¯èª¤è¨Šæ¯ return res.status(401).send(&#123; message: &quot;ç„¡æ•ˆçš„ token!&quot; &#125;); &#125;&#125;; 2. ç´°ç²’åº¦å­˜å–æ§åˆ¶Fine-Grained Access Controlå®šç¾©è§’è‰²å’Œæ¬Šé™å®šç¾©æ¯å€‹è§’è‰²å¯ä»¥åšä»€éº¼äº‹æƒ…ï¼Œåƒæ˜¯Adminå¯ä»¥é€²å…¥æ§åˆ¶å°ä»‹é¢ï¼ŒUserå‰‡ä¸è¡Œã€‚ RBAC (Role-Based Access Control)RBACæ˜¯ä¸€ç¨®åŸºæ–¼è§’è‰²çš„è¨ªå•æ§åˆ¶æ©Ÿåˆ¶ï¼Œæ¯å€‹è§’è‰²éƒ½è¢«æˆäºˆä¸€äº›æ¬Šé™ï¼Œæ ¹æ“šç”¨æˆ¶çš„è§’è‰²ä¾†æ±ºå®šå°ç³»çµ±è³‡æºçš„è¨ªå•æ¬Šé™ã€‚åœ¨é€™ç¨®æ¨¡å¼ä¸‹ï¼Œè¨ªå•æ¬Šé™æœƒè¢«è³¦äºˆè§’è‰²ï¼Œç”¨æˆ¶æœƒè¢«æŒ‡æ´¾åˆ°ä¸€å€‹æˆ–å¤šå€‹è§’è‰²ï¼Œé€™æ¨£å°±èƒ½ç²å¾—ç›¸æ‡‰çš„è¨ªå•æ¬Šé™ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738// å‡è¨­çš„ç”¨æˆ¶è³‡æ–™å’Œè§’è‰²const users = [ &#123; id: 1, username: &#x27;Lando&#x27;, role: &#x27;admin&#x27; &#125;, &#123; id: 2, username: &#x27;Josh&#x27;, role: &#x27;user&#x27; &#125;];// ç°¡å–®çš„èº«ä»½é©—è­‰ä¸­é–“ä»¶function authMiddleware(req, res, next) &#123; const user = users.find(u =&gt; u.username === req.headers.username); // å‡è¨­ä½¿ç”¨usernameé€²è¡Œç°¡å–®çš„&quot;èº«ä»½é©—è­‰&quot; if (!user) &#123; return res.status(401).send(&#x27;Authentication failed&#x27;); &#125; req.user = user; next();&#125;// å·²å®šç¾©å¥½çš„è§’è‰²æ¬Šé™const rolesPermissions = &#123; admin: [&#x27;create&#x27;, &#x27;read&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;], user: [&#x27;read&#x27;]&#125;;// RBACä¸­é–“ä»¶function roleMiddleware(allowedRoles) &#123; return function(req, res, next) &#123; const userRole = req.user.role; const permissions = rolesPermissions[userRole] || []; const isAllowed = allowedRoles.some(role =&gt; permissions.includes(role)); if (!isAllowed) &#123; return res.status(403).send(&#x27;Access denied&#x27;); &#125; next(); &#125;;&#125;app.get(&#x27;/data&#x27;, authMiddleware, roleMiddleware([&#x27;read&#x27;]), (req, res) =&gt; &#123; res.send(&#x27;Some data accessible by users with read permission&#x27;);&#125;); ABAC (Attribute-Based Access Control)ABACèƒ½å¤ æä¾›åŸºæ–¼å¤šç¨®æ¢ä»¶çš„ç´°ç²’åº¦è¨ªå•æ§åˆ¶ï¼Œç•¶éœ€è¦æ ¹æ“šç”¨æˆ¶çš„å…·é«”å±¬æ€§ï¼ˆå¹´é½¡ã€ä½ç½®ã€å·¥ä½œè§’è‰²ç­‰ï¼‰ä¾†ç´°åŒ–è¨ªå•æ¬Šé™ï¼Œé€šå¸¸æœƒä½¿ç”¨æ–¼æ›´è¤‡é›œæˆ–æ˜¯éœ€è¦æ¥µåº¦å®‰å…¨æ€§çš„å ´æ™¯ï¼Œä¾‹å¦‚è»äº‹ç³»çµ±ã€æ”¿åºœç­‰ã€‚ 3. API Gatewayæå‡å®‰å…¨æ€§ä½ å¯ä»¥æŠŠAPIç¶²é—œæƒ³åƒæˆæ‰€æœ‰APIçš„å‰é–€ï¼Œæ‰€æœ‰è«‹æ±‚éƒ½å¿…é ˆå…ˆé€šéå‰é–€æ‰ç¢°å¾—åˆ°å¾Œé¢çš„APIï¼Œèˆ‰å€‹ä¾‹å­ï¼Œå‡å¦‚æ¯å€‹APIéƒ½æœ‰ä¸€æ¨£çš„èº«ä»½é©—è­‰middlewareï¼Œé€™æ¨£åªéœ€è¦åœ¨API gatewayåŠ å…¥èº«ä»½é©—è­‰ï¼Œå¦‚æ­¤ä¸€ä¾†æ‰€æœ‰è«‹æ±‚éƒ½æœƒå…ˆé€²è¡Œèº«ä»½é©—è­‰å¾Œï¼Œå†å°‡è«‹æ±‚è½‰ç™¼åˆ°ç›¸æ‡‰çš„API routeã€‚ APIç¶²é—œæœ‰ä»¥ä¸‹ç”¨é€”ï¼š å¢åŠ å®‰å…¨æ€§ï¼šé˜²æ­¢æœªç¶“æˆæ¬Šçš„è«‹æ±‚ã€æ¿«ç”¨ï¼Œæˆ–æ˜¯DDoSæ”»æ“Šã€‚ Rate Limiting &#x2F; Throttlingï¼šé€Ÿç‡æ§åˆ¶å’Œç¯€æµï¼Œé˜²æ­¢APIéåº¦ä½¿ç”¨ï¼Œæˆ–æ˜¯ç¢ºä¿ä½¿ç”¨è€…ä¹‹é–“çš„å…¬å¹³ä½¿ç”¨ï¼Œå¯ä½¿ç”¨express-rate-limitå¥—ä»¶æˆ–æ˜¯å…¶ä»–å¹³å°çš„æœå‹™ï¼Œä¾‹å¦‚AWS API Gateway, Google Apigeeç­‰ã€‚ 12345678910111213141516const rateLimit = require(&#x27;express-rate-limit&#x27;);// å‰µå»º rate limit ä¸­é–“ä»¶const limiter = rateLimit(&#123; windowMs: 15 * 60 * 1000, // 15 åˆ†é˜çš„æ™‚é–“çª—å£ max: 100, // åœ¨æ™‚é–“çª—å£å…§æ¯å€‹IPå¯ä»¥ç™¼èµ·çš„æœ€å¤§è«‹æ±‚æ•¸ standardHeaders: true, // è¿”å› rate limit ä¿¡æ¯æ–¼ `RateLimit-*` headers legacyHeaders: false, // ç¦ç”¨ `X-RateLimit-*` headers message: &#x27;è«‹æ±‚éæ–¼é »ç¹ï¼Œè«‹åœ¨ä¸€æ®µæ™‚é–“å¾Œå†è©¦ã€‚&#x27; // ç•¶ rate limit è¢«è§¸ç™¼æ™‚è¿”å›çš„éŒ¯èª¤ä¿¡æ¯&#125;);// ä½¿ç”¨é€™å€‹ä¸­é–“ä»¶æ–¼ä½ çš„æ‡‰ç”¨ä¸­ï¼Œä¾‹å¦‚// app.use(limiter);// ä½ ä¹Ÿå¯ä»¥åªå°ç‰¹å®šçš„è·¯ç”±ä½¿ç”¨é€™å€‹ä¸­é–“ä»¶// app.use(&#x27;/api/&#x27;, limiter); è³‡æ–™é©—è­‰ï¼šé©—è­‰å‚³å…¥çš„è³‡æ–™æ˜¯å¦ç¬¦åˆæ ¼å¼æ¨™æº–ï¼Œäº¦å¯é é˜²SQL Injectionç­‰æ”»æ“Šã€‚ 4. DOMPurifyç•¶æˆ‘å€‘è¨­è¨ˆä¸€å€‹Inputçš„å…ƒä»¶çµ¦å®¢æˆ¶ç«¯åšè¼¸å…¥æ™‚ï¼Œä¹Ÿæœ‰æ©Ÿç‡é­å—åˆ°æ”»æ“Šï¼Œå› ç‚ºinputå¯ä»¥è¢«å¯«å…¥ç¨‹å¼ç¢¼ï¼Œä¾‹å¦‚ï¼š&lt;script&gt;alert(false)&lt;/script&gt;ï¼Œé€™æ™‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨DOMPurifyå¥—ä»¶ä¾†æ¸…é™¤è¼¸å…¥çš„è³‡æ–™ï¼Œé¿å…XSSæ”»æ“Šã€‚ å®‰è£12345// å…ˆåŸ·è¡Œå‘½ä»¤é€²è¡Œå®‰è£$ npm install dompurify// JS æª”æ¡ˆä¸­ importimport * as DOMPurify from &#x27;dompurify&#x27;; ä½¿ç”¨å‡å¦‚æˆ‘å€‘æœ‰ä¸€å€‹inputï¼Œå–å¾—ä½¿ç”¨è€…è³‡è¨Š 1&lt;input type=&quot;text&quot; id=&quot;userName&quot;&gt; å°‡è³‡è¨Šå‚³é€çµ¦å¾Œç«¯æ™‚å…ˆé€éDOMPurifyè™•ç†é 12const input = document.getElementById(&#x27;userName&#x27;);const userName = DOMPurify.sanitize(input.value); é€™æ¨£å°±å¯ä»¥æ¸…é™¤ç¨‹å¼ç¢¼çš„æ³¨å…¥ï¼Œå¤šæå‡äº†ä¸€é»å®‰å…¨æ€§ã€‚ 5. é€éSSL&#x2F;TLSåŠ å¯†å‚³è¼¸è³‡æ–™åˆ°ZeroSSLç¶²ç«™ç‚ºä½ çš„ç¶²åŸŸç”³è«‹SSLæ†‘è­‰ï¼Œç”³è«‹æˆåŠŸæœƒæ‹¿åˆ°certificate.crtä»¥åŠprivate.keyå…©å€‹æ†‘è­‰æª”æ¡ˆï¼Œè‡ªè¡Œå°‡å…¶æ”¾å…¥ä¼ºæœå™¨è³‡æ–™å¤¾ï¼ˆæˆ‘æ˜¯æ”¾åˆ° &#x2F;etc&#x2F;ssl ç›®éŒ„åº•ä¸‹ ï¼‰ï¼Œå†é€énginx.confè¨­å®šSSLæ†‘è­‰è·¯å¾‘ï¼Œä¿å­˜å¾ŒåŸ·è¡ŒNginxå³å¯ã€‚ 1234567891011121314server &#123; listen 443 ssl; server_name yourdomain.com; ssl_certificate /path/to/your/certificate.crt; # Path to your fullchain.pem from CA ssl_certificate_key /path/to/your/private.key; # Path to your private key from CA # æŒ‡å®šTLSç‰ˆæœ¬ ssl_protocols TLSv1.2 TLSv1.3; # å®šç¾©åŠ å¯†å¥—ä»¶ ssl_ciphers &#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256...&#x27;; # å…¶é¤˜è¨­å®š&#125; ssl_protocols : æŒ‡å®šTLSç‰ˆæœ¬äº¦å¯æå‡å®‰å…¨æ€§ï¼Œåœ¨æ­¤æŒ‡å®š1.2è·Ÿ1.3ç‰ˆæœ¬çš„é€£ç·šï¼Œå› ç‚ºé€™äº›æ˜¯ç›®å‰è¢«èªç‚ºæ˜¯å®‰å…¨çš„å”è­°ç‰ˆæœ¬ï¼Œè¼ƒèˆŠçš„å”è­°ç‰ˆæœ¬ï¼ˆå¦‚ SSL v2ã€SSL v3ã€TLS v1.0ï¼‰å› å·²çŸ¥çš„å®‰å…¨æ¼æ´è€Œä¸å»ºè­°ä½¿ç”¨ã€‚ ssl_ciphers : é€™å€‹æŒ‡ä»¤ç”¨ä¾†å®šç¾©å“ªäº›åŠ å¯†å¥—ä»¶ï¼ˆcipher suitesï¼‰è¢«å…è¨±ç”¨æ–¼ SSL&#x2F;TLS é€£ç·šã€‚åŠ å¯†å¥—ä»¶å®šç¾©äº†æ•¸æ“šåŠ å¯†ã€é©—è­‰å’Œæ¶ˆæ¯å®Œæ•´æ€§æª¢æŸ¥çš„ç®—æ³•ã€‚ é™¤äº†åƒSSLé€™ç¨®åŠ å¯†å‚³è¼¸çš„æ–¹å¼ä»¥å¤–ï¼Œä¹Ÿæœ‰ä¸€äº›éœæ…‹åŠ å¯†çš„æ–¹æ³• bcrypt : åŠ å¯†å¥—ä»¶ï¼Œåœ¨å­˜å…¥è³‡æ–™åº«ä¹‹å‰å…ˆå°è³‡æ–™é€²åŠ å¯†ã€‚ MySQL : InnoDBè¡¨ç©ºé–“åŠ å¯†ï¼Œåœ¨è³‡æ–™å¯«å…¥ç£ç¢Ÿå‰è¢«åŠ å¯†ï¼Œå¾ç£ç¢Ÿè®€å–æ™‚è§£å¯†ã€‚ MongoDB : åŠ å¯†å„²å­˜å¼•æ“ï¼Œä¹Ÿæ˜¯åœ¨å„²å­˜è³‡æ–™ä¹‹å‰å…ˆå°‡å…¶åŠ å¯†ã€‚ ç¸½çµæå‡APIçš„å®‰å…¨æ€§é™¤äº†èƒ½å¤ ä¿éšœä½ çš„æ•¸ä½è³‡ç”¢ï¼ŒåŒæ™‚ä¹Ÿèƒ½å¤ ä¿éšœç”¨æˆ¶å°ä½ çš„ä¿¡ä»»ï¼Œåœ¨é–‹ç™¼APIå‰ä¸å¦¨é€£åŒå®‰å…¨æ€§ä¹Ÿä¸€èµ·è€ƒæ…®é€²å»ï¼Œä»¥é˜²ç¯„å„ç¨®ç¶²è·¯å¨è„…ã€‚"},{"title":"å¾®æœå‹™ vs å–®é«”å¼æ¶æ§‹","path":"/2024/02/14/MicroservicesMonolithic/","content":"Microservices &amp; Monolithic Architectureå‰è¨€æˆ‘å€‘ä»¥å¾€éƒ½æ˜¯é€éå–®é«”å¼æ¶æ§‹ï¼ˆMonolithicï¼‰å»è™•ç†å„ç¨®æœå‹™ï¼Œä¸”æ¯å€‹æœå‹™å¯èƒ½éƒ½ä¾è³´æ–¼åŒä¸€å€‹databaseï¼Œåœ¨éƒ¨ç½²ä¸Šä¹Ÿåªæ‰“åŒ…æˆä¸€å€‹åç‚ºâ€backendâ€çš„containerï¼Œå¦‚ä¸‹åœ– ä½†å¾®æœå‹™ä¸ä¸€æ¨£çš„é»åœ¨æ–¼ï¼Œä»–æ˜¯å°‡æ¯å€‹æœå‹™ç¨ç«‹æˆè‡ªå·±çš„ä¼ºæœå™¨ï¼Œä»¥åŠé…ç½®ä»–å€‘å°ˆç”¨çš„è³‡æ–™åº«ã€‚ Microservicesæ¶æ§‹å¦‚ä¸‹åœ–ï¼š æ¯å€‹æœå‹™éƒ½æœ‰ä»–å€‘å°ˆå±¬çš„DBï¼Œè€Œé€™äº›æœå‹™ä¸éœ€è¦éƒ½ç”¨åŒä¸€ç¨®èªè¨€å»ç·¨å¯«ï¼Œå¯ä»¥æ˜¯ä¸åŒèªè¨€ï¼Œæœ€çµ‚åªéœ€è¦é€éProtobufå»äº’ç›¸èª¿ç”¨å³å¯ Microservices vs Monolithic Architectureå¾®æœå‹™æ¶æ§‹ï¼ˆMicroservicesï¼‰èˆ‡å–®é«”æ¶æ§‹ï¼ˆMonolithic Architectureï¼‰çš„å„ªç¼ºé»æ¯”è¼ƒ ç‰¹æ€§ å¾®æœå‹™æ¶æ§‹ å–®é«”æ¶æ§‹ é–‹ç™¼è¤‡é›œæ€§ è¼ƒé«˜ï¼Œéœ€è¦ç®¡ç†å¤šå€‹æœå‹™çš„äº¤äº’ è¼ƒä½ï¼Œæ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ä¸€å€‹æ‡‰ç”¨ä¸­ æŠ€è¡“æ£§éˆæ´»æ€§ é«˜ï¼Œä¸åŒå¾®æœå‹™å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€è¡“æ£§ ä½ï¼Œæ•´å€‹æ‡‰ç”¨é€šå¸¸ä½¿ç”¨å–®ä¸€æŠ€è¡“æ£§ éƒ¨ç½² ç¨ç«‹éƒ¨ç½²ï¼Œå–®ä¸€æœå‹™çš„æ›´æ–°ä¸æœƒå½±éŸ¿å…¶ä»–æœå‹™ æ•´é«”éƒ¨ç½²ï¼Œä»»ä½•ä¸€å€‹å°æ”¹å‹•éƒ½éœ€è¦é‡æ–°éƒ¨ç½²æ•´å€‹æ‡‰ç”¨ æ“´å±•æ€§ é«˜ï¼Œå¯ä»¥æ ¹æ“šéœ€æ±‚ç¨ç«‹æ“´å±•ç‰¹å®šæœå‹™ ä½è‡³ä¸­ï¼Œæ“´å±•é€šå¸¸æ„å‘³è‘—æ“´å±•æ•´å€‹æ‡‰ç”¨ å®¹éŒ¯æ€§ é«˜ï¼Œä¸€å€‹æœå‹™çš„å¤±æ•—ä¸æœƒå°è‡´æ•´å€‹æ‡‰ç”¨å¤±æ•— ä½ï¼Œä»»ä½•ä¸€å€‹éƒ¨åˆ†çš„å¤±æ•—å¯èƒ½å½±éŸ¿æ•´å€‹æ‡‰ç”¨ é–‹ç™¼å’Œç¶­è­·æˆæœ¬ è¼ƒé«˜ï¼Œéœ€è¦é¡å¤–çš„ç®¡ç†å’Œå”èª¿ è¼ƒä½ï¼Œæ‰€æœ‰ä»£ç¢¼åœ¨åŒä¸€è™•ç®¡ç† è³‡æ–™ä¸€è‡´æ€§ æŒ‘æˆ°è¼ƒå¤§ï¼Œéœ€è¦ç®¡ç†è·¨æœå‹™çš„è³‡æ–™ä¸€è‡´æ€§ è¼ƒå®¹æ˜“å¯¦ç¾ï¼Œå› ç‚ºæ‰€æœ‰è³‡æ–™è™•ç†åœ¨åŒä¸€æ‡‰ç”¨å…§ å•Ÿå‹•æ™‚é–“ å¿«ï¼Œå–®å€‹å¾®æœå‹™å•Ÿå‹•æ™‚é–“çŸ­ æ…¢ï¼Œéš¨è‘—æ‡‰ç”¨è¦æ¨¡å¢åŠ ï¼Œå•Ÿå‹•æ™‚é–“å¯èƒ½è®Šé•· æ¸¬è©¦ è¤‡é›œï¼Œéœ€è¦è€ƒæ…®æœå‹™é–“çš„äº¤äº’å’Œé›†æˆæ¸¬è©¦ ç›¸å°ç°¡å–®ï¼Œå› ç‚ºæ‰€æœ‰åŠŸèƒ½éƒ½åœ¨ä¸€å€‹ç’°å¢ƒä¸­ åœ˜éšŠå”ä½œ ä¿ƒé€²å°åœ˜éšŠç¨ç«‹å·¥ä½œï¼Œæé«˜æ•æ·æ€§ éœ€è¦æ›´å¤§çš„åœ˜éšŠå”ä½œï¼Œå¯èƒ½å°è‡´æºé€šæˆæœ¬å¢åŠ  å„å€‹æœå‹™é–“å¦‚ä½•äº’ç›¸æºé€šï¼Ÿç”±æ–¼æ¯å€‹æœå‹™éƒ½æ˜¯ç¨ç«‹çš„ï¼Œé‚£æœå‹™ä¹‹é–“è©²å¦‚ä½•äº’ç›¸æºé€šï¼Ÿå‡è¨­ä¸€å€‹é›»å•†ç¶²ç«™ä¸­ä¸»è¦æœ‰Customer, Products, Shoppingï¼Œä¸‰ç¨®ç¨ç«‹çš„æœå‹™ï¼Œä½†Productséœ€è¦ä¾è³´æ–¼Customeræœå‹™çš„è³‡æ–™ï¼Œè©²æ€éº¼è¾¦ï¼Ÿ ç›´æ¥æœå‹™é–“èª¿ç”¨ï¼š åŒæ­¥èª¿ç”¨ï¼š åœ¨Productsæœå‹™ä¸­é€éHTTPã€gRPCç­‰é€šè¨Šå”è­°ï¼Œç›´æ¥å°customeræœå‹™ç™¼é€è«‹æ±‚èª¿ç”¨è³‡æ–™ã€‚ äº¦æ­¥èª¿ç”¨ï¼š ä½¿ç”¨æ¶ˆæ¯éšŠåˆ—ï¼ˆå¦‚RabbitMQã€Kafkaç­‰ï¼‰å¯¦ç¾ç•°æ­¥é€šè¨Šï¼Œproductsæœå‹™ç™¼å¸ƒæ¶ˆæ¯åˆ°éšŠåˆ—ï¼Œcustomeræœå‹™è¨‚é–±ç›¸æ‡‰çš„æ¶ˆæ¯é€²è¡Œè™•ç†ï¼Œä¸¦å°‡çµæœé€šéå›èª¿æˆ–å†æ¬¡ç™¼å¸ƒæ¶ˆæ¯çš„æ–¹å¼å›å‚³ã€‚ é€™ç¨®æ–¹å¼é©ç”¨æ–¼ä¸éœ€è¦å³æ™‚éŸ¿æ‡‰çš„å ´æ™¯ï¼Œèƒ½æœ‰æ•ˆåˆ†æ•£é«˜å³°æµé‡ã€‚ APIç¶²é—œ (Gateway) ä½¿ç”¨API gatewayä½œç‚ºæœå‹™é–“çš„ä¸­ä»‹ï¼Œæ‰€æœ‰å¤–éƒ¨è«‹æ±‚éƒ½æœƒå…ˆç¶“éAPI gatewayï¼Œä¸¦é€éproxyå°‡è«‹æ±‚å°å‘ç›¸æ‡‰çš„æœå‹™ã€‚ ç•¶productæœå‹™éœ€è¦customeræœå‹™çš„è³‡æ–™æ™‚ï¼Œå¯ä»¥é€éAPI gatewayè½‰ç™¼è«‹æ±‚ã€‚é€™ç¨®æ–¹å¼å¯ä»¥åœ¨ API ç¶²é—œå±¤é¢çµ±ä¸€è™•ç†èªè­‰ã€æˆæ¬Šã€ç›£æ§ç­‰è·¨æœå‹™çš„å…±é€šé—œåˆ‡ã€‚ é€égatewayç®¡ç†è«‹æ±‚ï¼Œç™¼é€åˆ°ä¸åŒæœå‹™ 12345678910111213141516171819//API Gatewayconst express = require(&#x27;express&#x27;)const cors = require(&#x27;cors&#x27;)const proxy = require(&#x27;express-http-proxy&#x27;)const app = express()const PORT = 8000app.use(cors())app.use(express.json())app.use(&#x27;/customer&#x27;, proxy(&#x27;http://localhost:8001&#x27;))app.use(&#x27;/shopping&#x27;, proxy(&#x27;http://localhost:8003&#x27;))app.use(&#x27;/&#x27;, proxy(&#x27;http://localhost:8002&#x27;)) // productsapp.listen(PORT, () =&gt; &#123; console.log(`Gateway is running on http://localhost:$&#123;PORT&#125;`)&#125;) å…±äº«è³‡æ–™åº« é›–ç„¶åœ¨å¾®æœå‹™æ¶æ§‹ä¸­æå€¡æ¯å€‹æœå‹™éƒ½æ“æœ‰è‡ªå·±çš„è³‡æ–™åº«ï¼Œä½†åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œæœå‹™é–“ä¹Ÿå¯ä»¥é€šéå…±äº«è³‡æ–™åº«çš„æ–¹å¼ä¾†é”æˆè³‡æ–™é€šè¨Šï¼Œä½†è¦æ³¨æ„è³‡æ–™çš„ä¸€è‡´æ€§èˆ‡éš”é›¢æ€§ï¼Œé¿å…ç”¢ç”Ÿç·Šè€¦åˆã€‚ ç¸½çµå¾®æœå‹™é›–ç„¶å¥½è™•å¤šå¤šï¼Œä½†ç¶­è­·ä»¥åŠè³‡æ–™ä¸€è‡´æ€§ä¸Šé‚„æ˜¯æœ‰äº›æŒ‘æˆ°ï¼Œå°æ–¼æ“´å±•å¤§å‹æ‡‰ç”¨å°±å¾ˆé©åˆä½¿ç”¨å¾®æœå‹™ï¼Œç›¸å°çš„ï¼Œåœ¨é–‹ç™¼å°å‹å°ˆæ¡ˆæˆ–æ˜¯åˆæœŸéšæ®µï¼Œé‚„æ˜¯é¸æ“‡å–®é«”å¼æ¶æ§‹è¼ƒå®¹æ˜“äº›ã€‚ä¹Ÿå› æ­¤ï¼Œåœ¨é–‹ç™¼å°ˆæ¡ˆå‰å¯ä»¥äº‹å…ˆè€ƒæ…®é•·é å› ç´ ï¼Œæ¯”å¦‚ç¶­è­·æˆæœ¬ã€ç³»çµ±çš„å¾©é›œåº¦ã€ä»¥åŠåœ˜éšŠçš„æŠ€è¡“èƒ½åŠ›ç­‰ï¼Œå†é¸æ“‡é©åˆçš„æ¶æ§‹æ¯”è¼ƒå¥½ã€‚æ­¤ç¯‡æ–‡ç« åƒ…è¨˜éŒ„ç­†è€…è’é›†è³‡æ–™å½™æ•´çµæœï¼Œè‹¥æœ‰ä»»ä½•éŒ¯èª¤æ­¡è¿æŒ‡æ•™ï¼Œè¬åˆ†æ„Ÿè¬ã€‚ Referencehttps://ithelp.ithome.com.tw/articles/10228461"},{"title":"Bloom Filter å¸ƒéš†éæ¿¾å™¨","path":"/2024/02/05/BloomFilter/","content":"å¦‚ä½•åœ¨ä¸Šå„„ç­†ä½¿ç”¨è€…ä¸­æª¢æŸ¥åç¨±æ˜¯å¦å­˜åœ¨å‰è¨€åœ¨APPè¨»å†Šæ™‚ï¼Œæœ‰æ™‚æœƒè¢«æç¤ºä½¿ç”¨è€…åç¨±å·²å­˜åœ¨ï¼Œé€™å€‹åŠŸèƒ½è©²å¦‚ä½•å¯¦ç¾ï¼Ÿæ¯”è¼ƒç›´è¦ºçš„æ–¹æ³•æ˜¯ç›´æ¥åœ¨è³‡æ–™åº«ä¸­é€²è¡Œæª¢ç´¢ï¼Œä½†è³‡æ–™é‡åˆ°é”å„„ç´šåˆ¥æ™‚ï¼Œé€™ç¨®æ–¹æ³•è‚¯å®šä¸å¯è¡Œï¼Œæ­¤ç¯‡æœƒåˆ©ç”¨Rediså…§å»ºå¸ƒéš†éæ¿¾å™¨ï¼ˆBloom Filterï¼‰è³‡æ–™çµæ§‹å¯¦ç¾ ä½¿ç”¨è³‡æ–™åº«æŸ¥è©¢1SELECT COUNT(*) FROM users WHERE username = ? æ­¤æ–¹æ³•æœƒæœ‰ä»¥ä¸‹ç¼ºé» åœ¨è³‡æ–™é‡å¤§çš„æƒ…æ³ï¼Œé »ç¹é€²è¡Œè³‡æ–™åº«æŸ¥è©¢ï¼Œæœƒé€ æˆæ•ˆèƒ½ä¸‹é™ã€å»¶é²ï¼Œä¸”æŸ¥è©¢é€Ÿåº¦ç·©æ…¢ è³‡æ–™åº«è² è¼‰é«˜ï¼Œæ¯å€‹æŸ¥è©¢éƒ½æœƒæ¶ˆè€—è³‡æºï¼ŒCPUå’ŒI&#x2F;O è³‡æ–™å­˜æ”¾æ–¼å¿«å–å¿«å–æœƒä½”ç”¨è¨˜æ†¶é«”ç©ºé–“ï¼Œç›´æ¥å°‡ä¸Šå„„ç­†è³‡æ–™æ”¾å…¥å¿«å–ä¸¦éå¥½çš„è¾¦æ³• å¸ƒéš†éæ¿¾å™¨(Bloom Filter)åœ¨æ­¤ä»¥æŸ¥è©¢ä½¿ç”¨è€…åç¨±ç‚ºä¾‹ éæ¿¾å™¨æ ¸å¿ƒæ€æƒ³å¦‚ä¸‹ Bit Array ï¼šä¸€æ¢å¤§å‹å…ƒé™£åˆ—ï¼Œæ¯å€‹ä½ç½®åˆå§‹å€¼ç‚ºé›¶ï¼Œæ¯å€‹ä½ç½®åªæœƒå­˜æ”¾0æˆ–1ï¼Œç”¨ä¾†è¡¨ç¤ºè©²å…ƒç´ ï¼ˆä½¿ç”¨è€…åç¨±ï¼‰æ˜¯å¦å­˜åœ¨ã€‚ Hash Functionsï¼šéæ¿¾å™¨ä½¿ç”¨å¤šå€‹å“ˆå¸Œå‡½æ•¸ï¼Œæ¯å€‹å‡½æ•¸å¯ä»¥å°‡è¼¸å…¥çš„ä½¿ç”¨è€…åç¨±æ˜ å°„åˆ°bit arrayçš„ä¸€å€‹æˆ–å¤šå€‹ä½ç½®ã€‚ ä½¿ç”¨ä¸Šæœ‰å…©ç¨®æ–¹æ³• æ–°å¢å…ƒç´  æŸ¥è©¢å…ƒç´  å‡è¨­è³‡æ–™åº«ä¸­æœ‰ä¸€å„„ç­†ä½¿ç”¨è€…ï¼Œè¦å…ˆå°‡æ‰€æœ‰ä½¿ç”¨è€…é€ä¸€æ·»åŠ è‡³å¸ƒéš†éæ¿¾å™¨ï¼Œé€éHash Functionsæ˜ å°„è‡³bit arrayï¼Œç•¶æ¬²æŸ¥è©¢ä½¿ç”¨è€…æ˜¯å¦å­˜åœ¨ï¼Œæœƒå°‡ä½¿ç”¨è€…åç¨±é€éHash Functionsæ˜ å°„è‡³bit arrayç›¸æ‡‰ä½ç½®ï¼Œè‹¥è©²ä½ç½®ç‚º1ï¼Œä»£è¡¨å­˜åœ¨ï¼Œè‹¥ç‚º0ä»£è¡¨ä¸å­˜åœ¨ã€‚ ç¨‹å¼ç¯„ä¾‹12345678910111213141516171819202122232425262728293031323334const Redis = require(&#x27;ioredis&#x27;);const redis = new Redis(); // é€£æ¥åˆ° Redis æœå‹™å™¨async function setupBloomFilter() &#123; // å‰µå»ºä¸€å€‹å¸ƒéš†éæ¿¾å™¨ï¼Œåç‚º &#x27;usersFilter&#x27;ï¼Œé è¨ˆæ’å…¥é‡ç‚º 1000000000ï¼ŒéŒ¯èª¤ç‡ç‚º 0.01 await redis.call(&#x27;BF.RESERVE&#x27;, &#x27;usersFilter&#x27;, 0.01, 1000000000); // å‡è¨­é€™æ˜¯å¾ MySQL æ•¸æ“šåº«ä¸­ç²å–çš„ç”¨æˆ¶ååˆ—è¡¨ const usernames = [&#x27;user1&#x27;, &#x27;user2&#x27;, &#x27;user3&#x27;]; // å°‡ç”¨æˆ¶ååŠ å…¥åˆ°å¸ƒéš†éæ¿¾å™¨ä¸­ for (let username of usernames) &#123; await redis.call(&#x27;BF.ADD&#x27;, &#x27;usersFilter&#x27;, username); &#125;&#125;async function checkUserExists(username) &#123; // æª¢æŸ¥å¸ƒéš†éæ¿¾å™¨ä¸­æ˜¯å¦å­˜åœ¨è©²ç”¨æˆ¶å const exists = await redis.call(&#x27;BF.EXISTS&#x27;, &#x27;usersFilter&#x27;, username); if (exists) &#123; console.log(`ç”¨æˆ¶å $&#123;username&#125; å¯èƒ½å­˜åœ¨ã€‚`); &#125; else &#123; console.log(`ç”¨æˆ¶å $&#123;username&#125; ä¸å­˜åœ¨ã€‚`); &#125;&#125;async function main() &#123; await setupBloomFilter(); // è¨­ç½®å¸ƒéš†éæ¿¾å™¨ä¸¦æ·»åŠ ç”¨æˆ¶å await checkUserExists(&#x27;user1&#x27;); // æª¢æŸ¥ &#x27;user1&#x27; æ˜¯å¦å­˜åœ¨ await checkUserExists(&#x27;user4&#x27;); // æª¢æŸ¥ &#x27;user4&#x27; æ˜¯å¦å­˜åœ¨ redis.quit();&#125;main(); å¸ƒéš†éæ¿¾å™¨å„ªç¼ºé»å„ªé» ç¯€çœå…§å­˜ç©ºé–“ï¼Œä¸éœ€ç›´æ¥å°‡ä¸Šå„„ç­†å¯¦éš›è³‡æ–™å­˜æ”¾åœ¨å¿«å–ï¼Œè€Œæ˜¯åªå­˜æ”¾é€éhash functionsè½‰æ›çš„å“ˆå¸Œå€¼ã€‚ é«˜æ•ˆç‡æŸ¥è©¢ï¼Œä¸ç”¨æœç´¢æ•´å€‹è³‡æ–™åº«ï¼Œæ™‚é–“è¤‡é›œåº¦åƒ…ç‚ºO(1) ç¼ºé» å­˜åœ¨èª¤åˆ¤ç‡ï¼Œæœ‰å¯èƒ½æœƒèª¤åˆ¤è©²å…ƒç´ å·²å­˜åœ¨ï¼Œä½†çµ•å°ä¸æœƒèª¤åˆ¤è©²å…ƒç´ ä¸å­˜åœ¨ï¼å› æ­¤ä¸ç”¨æ“”å¿ƒé‡åçš„å•é¡Œ ä¸èƒ½åˆªé™¤å…ƒç´ ï¼Œå¾é›†åˆä¸­åˆªé™¤å…ƒç´ æœƒå½±éŸ¿å“ˆå¸Œå€¼ï¼Œå¢åŠ èª¤åˆ¤ç‡ åŠ å…¥éæ¿¾å™¨çš„è€—æ™‚å•é¡Œ å°‡åå„„ç­†è³‡æ–™åŠ å…¥å¸ƒéš†éæ¿¾å™¨çš„ç¢ºå¯èƒ½æœƒç›¸ç•¶è€—æ™‚ï¼Œé€™å–æ±ºæ–¼æ‚¨çš„ç¡¬é«”è³‡æºã€å¸ƒéš†éæ¿¾å™¨çš„å¯¦ç¾æ–¹å¼ä»¥åŠæ•¸æ“šçš„åŠ è¼‰é€Ÿåº¦ã€‚ç‚ºäº†å„ªåŒ–é€™ä¸€éç¨‹ï¼Œå¯ä»¥è€ƒæ…®ä»¥ä¸‹å¹¾é»ï¼š æ‰¹é‡è™•ç†ï¼šåœ¨åŠ è¼‰æ•¸æ“šåˆ°å¸ƒéš†éæ¿¾å™¨æ™‚ï¼Œå¯ä»¥æ¡ç”¨æ‰¹é‡è™•ç†çš„æ–¹å¼ï¼Œä»¥æ¸›å°‘å–®æ¬¡æ’å…¥çš„é–‹éŠ·ã€‚ å¾Œå°è™•ç†ï¼šå¯ä»¥åœ¨ä¼ºæœå™¨å•Ÿå‹•å¾Œï¼Œåˆ©ç”¨å¾Œå°ä»»å‹™é€²è¡Œæ•¸æ“šçš„åŠ è¼‰ï¼Œä»¥é¿å…é˜»å¡ä¸»è¦çš„æœå‹™æµç¨‹ã€‚ åˆ†æ®µåŠ è¼‰ï¼šå¦‚æœå¯èƒ½ï¼Œå¯ä»¥å°‡å¸ƒéš†éæ¿¾å™¨çš„å»ºç«‹å’Œæ›´æ–°éç¨‹åˆ†æ®µé€²è¡Œï¼Œé¿å…ä¸€æ¬¡æ€§è™•ç†æ‰€æœ‰æ•¸æ“šã€‚ è³‡æ–™åº«æœ‰æ–°å¢ä½¿ç”¨è€…çš„è™•ç†æ–¹å¼ å°æ–¼è³‡æ–™åº«ä¸­æ–°å¢çš„ä½¿ç”¨è€…ï¼Œç¢ºå¯¦éœ€è¦å°‡é€™äº›æ–°ä½¿ç”¨è€…åŠ å…¥åˆ°å¸ƒéš†éæ¿¾å™¨ä¸­ï¼Œä»¥ä¿æŒå¸ƒéš†éæ¿¾å™¨æ•¸æ“šçš„æœ€æ–°æ€§ã€‚é€™å€‹éç¨‹å¯ä»¥é€šéä»¥ä¸‹æ–¹å¼é€²è¡Œï¼š å³æ™‚æ›´æ–°ï¼šæ¯ç•¶è³‡æ–™åº«æ–°å¢ä¸€å€‹ä½¿ç”¨è€…æ™‚ï¼ŒåŒæ™‚å°‡é€™å€‹ä½¿ç”¨è€…åç¨±åŠ å…¥åˆ°å¸ƒéš†éæ¿¾å™¨ä¸­ã€‚é€™è¦æ±‚ç³»çµ±èƒ½å¤ è™•ç†é€™äº›å³æ™‚æ›´æ–°çš„æ“ä½œã€‚ å®šæœŸæ›´æ–°ï¼šæ ¹æ“šç³»çµ±çš„å¯¦éš›éœ€æ±‚å’Œå®¹éŒ¯ç‡ï¼Œå¯ä»¥é¸æ“‡å®šæœŸå°‡æ–°å¢çš„ä½¿ç”¨è€…åç¨±æ‰¹é‡åŠ å…¥åˆ°å¸ƒéš†éæ¿¾å™¨ä¸­ã€‚ æ¬²åˆªé™¤ä½¿ç”¨è€…çš„è™•ç†æ–¹å¼å¸ƒéš†éæ¿¾å™¨ä¸æ”¯æŒç›´æ¥å¾é›†åˆä¸­åˆªé™¤ä½¿ç”¨è€… 1. ä½¿ç”¨å¯è¨ˆæ•¸çš„å¸ƒéš†éæ¿¾å™¨ï¼ˆCounting Bloom Filterï¼‰å¯è¨ˆæ•¸çš„å¸ƒéš†éæ¿¾å™¨æ˜¯å¸ƒéš†éæ¿¾å™¨çš„ä¸€å€‹è®Šé«”ï¼Œå®ƒä¸åƒ…è¨˜éŒ„æŸä½æ˜¯å¦è¢«æ˜ å°„ï¼Œè€Œä¸”è¨˜éŒ„æ˜ å°„åˆ°è©²ä½çš„å…ƒç´ æ•¸é‡ã€‚é€™æ¨£ï¼Œç•¶æ‚¨éœ€è¦â€œåˆªé™¤â€ä¸€å€‹å…ƒç´ æ™‚ï¼Œåªéœ€å°‡è©²å…ƒç´ å°æ‡‰ä½ä¸Šçš„è¨ˆæ•¸æ¸›ä¸€ã€‚å¦‚æœè¨ˆæ•¸é™è‡³é›¶ï¼Œå‰‡ç›¸ç•¶æ–¼è©²ä½æœªè¢«ä»»ä½•å…ƒç´ æ˜ å°„ã€‚ä½†é€™ç¨®æ–¹æ³•éœ€è¦æ›´å¤šçš„ç©ºé–“ä¾†å­˜å„²è¨ˆæ•¸ä¿¡æ¯ã€‚ 2. é‡å»ºå¸ƒéš†éæ¿¾å™¨ç•¶è³‡æ–™åº«ä¸­åˆªé™¤äº†ä¸€äº›å…ƒç´ å¾Œï¼Œæ‚¨å¯ä»¥é€šéé‡æ–°å¾è³‡æ–™åº«ä¸­åŠ è¼‰å‰©é¤˜å…ƒç´ ä¾†é‡å»ºå¸ƒéš†éæ¿¾å™¨ã€‚é›–ç„¶é€™å€‹éç¨‹å¯èƒ½æ¯”è¼ƒè€—æ™‚ï¼Œä½†å®ƒèƒ½å¤ ç¢ºä¿å¸ƒéš†éæ¿¾å™¨ä¸­çš„ä¿¡æ¯èˆ‡è³‡æ–™åº«ä¿æŒä¸€è‡´ã€‚é€™ç¨®æ–¹æ³•é©ç”¨æ–¼å…ƒç´ åˆªé™¤æ“ä½œä¸é »ç¹çš„å ´æ™¯ã€‚ 3. ä½¿ç”¨å…¶ä»–æ•¸æ“šçµæ§‹è¼”åŠ©å¦ä¸€ç¨®ç­–ç•¥æ˜¯çµåˆä½¿ç”¨å¸ƒéš†éæ¿¾å™¨å’Œå…¶ä»–æ•¸æ“šçµæ§‹ï¼Œä¾‹å¦‚å“ˆå¸Œè¡¨ã€‚ç•¶å¸ƒéš†éæ¿¾å™¨åˆ¤æ–·ä¸€å€‹å…ƒç´ å¯èƒ½å­˜åœ¨æ™‚ï¼Œå¯ä»¥é€²ä¸€æ­¥æŸ¥è©¢å“ˆå¸Œè¡¨ä¾†ç¢ºå®šè©²å…ƒç´ æ˜¯å¦çœŸçš„å­˜åœ¨ã€‚ç•¶å…ƒç´ è¢«åˆªé™¤æ™‚ï¼Œåªéœ€è¦å¾å“ˆå¸Œè¡¨ä¸­åˆªé™¤è©²å…ƒç´ ã€‚é€™æ¨£å¯ä»¥ä¿æŒå¿«é€ŸæŸ¥è©¢çš„åŒæ™‚ï¼Œä¹Ÿèƒ½å¤ è™•ç†å…ƒç´ çš„åˆªé™¤æ“ä½œã€‚"}]